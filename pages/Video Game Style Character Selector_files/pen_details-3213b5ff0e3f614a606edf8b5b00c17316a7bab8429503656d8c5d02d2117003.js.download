function BarDragger(e){this.handles=[e],this.bindHandles()}$.browser={},navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1?$.browser.safari=!0:$.browser.safari=!1,function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;return ctrlKey=shiftKey=altKey=!1,"string"==typeof settings&&(method=settings,params=extraSettings),options={id:"",nameSpace:"",root:"",previewHandler:!1,previewInWindow:"",previewInElement:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:!1,previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(e,t){miuScript=$(t).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])}),this.each(function(){function localize(e,t){return t?e.replace(/("|')~\//g,"$1"+options.root):e.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor"),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),options.resizeHandle===!0&&$.browser.safari!==!0&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var t,n,i=$$.height(),s=e.clientY;t=function(e){return $$.css("height",Math.max(20,e.clientY+i-s)+"px"),!1},n=function(){return $("html").unbind("mousemove.markItUp",t).unbind("mouseup.markItUp",n),!1},$("html").bind("mousemove.markItUp",t).bind("mouseup.markItUp",n)}),footer.append(resizeHandle)),$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed),$$.bind("insertion.markItUp",function(e,t){t.target!==!1&&get(),textarea===$.markItUp.focused&&markup(t)}),$$.bind("focus.markItUp",function(){$.markItUp.focused=this}),options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="button button-medium mini-button markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return!1}).bind("click.markItUp",function(){return!1}).bind("focusin.markItUp",function(){$$.focus()}).bind("mouseup",function(){return button.call&&eval(button.call)(),setTimeout(function(){markup(button)},1),!1}).bind("mouseenter.markItUp",function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(e){return e?(e=e.toString(),e=e.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(e,t){var n=t.split("|!|");return altKey===!0?void 0!==n[1]?n[1]:n[0]:void 0===n[1]?"":n[0]}),e=e.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(e,t){var n=t.split(":!:");return abort!==!0&&(value=prompt(n[0],n[1]?n[1]:""),null===value&&(abort=!0),value)})):""}function prepare(e){return $.isFunction(e)&&(e=e(hash)),magicMarkups(e)}function build(e){var t=prepare(clicked.openWith),n=prepare(clicked.placeHolder),i=prepare(clicked.replaceWith),s=prepare(clicked.closeWith),o=prepare(clicked.openBlockWith),r=prepare(clicked.closeBlockWith),a=clicked.multiline;if(""!==i)block=t+i+s;else if(""===selection&&""!==n)block=t+n+s;else{e=e||selection;var c=[e],u=[];a===!0&&(c=e.split(/\r?\n/));for(var l=0;l<c.length;l++){line=c[l];var d;(d=line.match(/ *$/))?u.push(t+line.replace(/ *$/g,"")+s+d):u.push(t+line+s)}block=u.join("\n")}return block=o+block+r,{block:block,openWith:t,replaceWith:i,placeHolder:n,closeWith:s}}function markup(e){var t,n,i,s;if(hash=clicked=e,get(),$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),ctrlKey===!0&&shiftKey===!0){for(lines=selection.split(/\r?\n/),n=0,i=lines.length,s=0;s<i;s++)""!==$.trim(lines[s])?($.extend(hash,{line:++n,selection:lines[s]}),lines[s]=build(lines[s]).block):lines[s]="";string={block:lines.join("\n")},start=caretPosition,t=string.block.length+($.browser.opera?i-1:0)}else ctrlKey===!0?(string=build(selection),start=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,t-=string.block.match(/ $/)?1:0,t-=fixIeBug(string.block)):shiftKey===!0?(string=build(selection),start=caretPosition,t=string.block.length,t-=fixIeBug(string.block)):(string=build(selection),start=caretPosition+string.block.length,t=0,start-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),start=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition}),string.block!==selection&&abort===!1?(insert(string.block),set(start,t)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(e){return $.browser.opera?e.length-e.replace(/\n*/g,"").length:0}function fixIeBug(e){return $.browser.msie?e.length-e.replace(/\r*/g,"").length:0}function insert(e){if(document.selection){var t=document.selection.createRange();t.text=e}else textarea.value=textarea.value.substring(0,caretPosition)+e+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(e,t){if(textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&0==t)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",e),range.moveEnd("character",t),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(e,e+t);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(textarea.focus(),scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,$.browser.msie){var e=document.selection.createRange(),t=e.duplicate();for(t.moveToElementText(textarea),caretPosition=-1;t.inRange(e);)t.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=textarea.value.substring(caretPosition,textarea.selectionEnd);return selection}function preview(){"function"==typeof options.previewHandler?previewWindow=!0:options.previewInElement?previewWindow=$(options.previewInElement):!previewWindow||previewWindow.closed?options.previewInWindow?(previewWindow=window.open("","preview",options.previewInWindow),$(window).unload(function(){previewWindow.close()})):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):altKey===!0&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview(),options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){if(options.previewHandler&&"function"==typeof options.previewHandler)options.previewHandler($$.val());else if(options.previewParser&&"function"==typeof options.previewParser){var e=options.previewParser($$.val());writeInPreview(localize(e,1))}else""!==options.previewParserPath?$.ajax({type:"POST",dataType:"text",global:!1,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(e){writeInPreview(localize(e,1))}}):template||$.ajax({url:options.previewTemplatePath,dataType:"text",global:!1,success:function(e){writeInPreview(localize(e,1).replace(/<!-- content -->/g,$$.val()))}});return!1}function writeInPreview(e){if(options.previewInElement)$(options.previewInElement).html(e);else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open(),previewWindow.document.write(e),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}}function keyPressed(e){if(shiftKey=e.shiftKey,altKey=e.altKey,ctrlKey=(!e.altKey||!e.ctrlKey)&&(e.ctrlKey||e.metaKey),"keydown"===e.type){if(ctrlKey===!0&&(li=$('a[accesskey="'+(13==e.keyCode?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li"),0!==li.length))return ctrlKey=!1,setTimeout(function(){li.triggerHandler("mouseup")},1),!1;if(13===e.keyCode||10===e.keyCode)return ctrlKey===!0?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):shiftKey===!0?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===e.keyCode)return 1!=shiftKey&&1!=ctrlKey&&1!=altKey&&(caretOffset!==-1?(get(),caretOffset=$$.val().length-caretOffset,set(caretOffset,0),caretOffset=-1,!1):(markup(options.onTab),options.onTab.keepDefault))}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor"),$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$),$$.data("markItUp",null)}var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;if($$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),method)switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}else init()})},$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})},$.markItUp=function(e){var t={target:!1};return $.extend(t,e),t.target?$(t.target).each(function(){$(this).focus(),$(this).trigger("insertion",[t])}):void $("textarea").trigger("insertion",[t])}}(jQuery),function(){"use strict";function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var i=e.prototype,s=this,o=s.EventEmitter;i.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp){t={};for(n in i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n])}else t=i[e]||(i[e]=[]);return t},i.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},i.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},i.addListener=function(e,n){var i,s=this.getListenersAsObject(e),o="object"==typeof n;for(i in s)s.hasOwnProperty(i)&&t(s[i],n)===-1&&s[i].push(o?n:{listener:n,once:!1});return this},i.on=n("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=n("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,n){var i,s,o=this.getListenersAsObject(e);for(s in o)o.hasOwnProperty(s)&&(i=t(o[s],n),i!==-1&&o[s].splice(i,1));return this},i.off=n("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,n){var i,s,o=e?this.removeListener:this.addListener,r=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)o.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(s=t[i])&&("function"==typeof s?o.call(this,i,s):r.call(this,i,s));return this},i.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},i.removeAllListeners=n("removeEvent"),i.emitEvent=function(e,t){var n,i,s,o,r=this.getListenersAsObject(e);for(s in r)if(r.hasOwnProperty(s))for(i=r[s].length;i--;)n=r[s][i],n.once===!0&&this.removeListener(e,n.listener),o=n.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},i.trigger=n("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return s.EventEmitter=o,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:s.EventEmitter=e}.call(this),function(e){"use strict";function t(t){var n=e.event;return n.target=n.target||n.srcElement||t,n}var n=document.documentElement,i=function(){};n.addEventListener?i=function(e,t,n){e.addEventListener(t,n,!1)}:n.attachEvent&&(i=function(e,n,i){e[n+i]=i.handleEvent?function(){var n=t(e);i.handleEvent.call(i,n)}:function(){var n=t(e);i.call(e,n)},e.attachEvent("on"+n,e[n+i])});var s=function(){};n.removeEventListener?s=function(e,t,n){e.removeEventListener(t,n,!1)}:n.detachEvent&&(s=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(i){e[t+n]=void 0}});var o={bind:i,unbind:s};"function"==typeof define&&define.amd?define(o):"object"==typeof exports?module.exports=o:e.eventie=o}(window),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(n,i){return t(e,n,i)}):"object"==typeof exports?module.exports=t(e,require("wolfy87-eventemitter"),require("eventie")):e.Unipointer=t(e,e.EventEmitter,e.eventie)}(window,function(e,t,n){"use strict";function i(){}function s(){}s.prototype=new t,s.prototype.bindStartEvent=function(e){this._bindStartEvent(e,!0)},s.prototype.unbindStartEvent=function(e){this._bindStartEvent(e,!1)},s.prototype._bindStartEvent=function(t,i){i=void 0===i||!!i;var s=i?"bind":"unbind";e.navigator.pointerEnabled?n[s](t,"pointerdown",this):e.navigator.msPointerEnabled?n[s](t,"MSPointerDown",this):(n[s](t,"mousedown",this),n[s](t,"touchstart",this))},s.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},s.prototype.getTouch=function(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i.identifier==this.pointerIdentifier)return i}},s.prototype.onmousedown=function(e){var t=e.button;t&&0!==t&&1!==t||this._pointerDown(e,e)},s.prototype.ontouchstart=function(e){this._pointerDown(e,e.changedTouches[0])},s.prototype.onMSPointerDown=s.prototype.onpointerdown=function(e){this._pointerDown(e,e)},s.prototype._pointerDown=function(e,t){this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,this.pointerDown(e,t))},s.prototype.pointerDown=function(e,t){this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t])};var o={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"],MSPointerDown:["MSPointerMove","MSPointerUp","MSPointerCancel"]};return s.prototype._bindPostStartEvents=function(t){if(t){for(var i=o[t.type],s=t.preventDefault?e:document,r=0,a=i.length;r<a;r++){var c=i[r];n.bind(s,c,this)}this._boundPointerEvents={events:i,node:s}}},s.prototype._unbindPostStartEvents=function(){var e=this._boundPointerEvents;if(e&&e.events){for(var t=0,i=e.events.length;t<i;t++){var s=e.events[t];n.unbind(e.node,s,this)}delete this._boundPointerEvents}},s.prototype.onmousemove=function(e){this._pointerMove(e,e)},s.prototype.onMSPointerMove=s.prototype.onpointermove=function(e){e.pointerId==this.pointerIdentifier&&this._pointerMove(e,e)},s.prototype.ontouchmove=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerMove(e,t)},s.prototype._pointerMove=function(e,t){this.pointerMove(e,t)},s.prototype.pointerMove=function(e,t){this.emitEvent("pointerMove",[e,t])},s.prototype.onmouseup=function(e){this._pointerUp(e,e)},s.prototype.onMSPointerUp=s.prototype.onpointerup=function(e){e.pointerId==this.pointerIdentifier&&this._pointerUp(e,e)},s.prototype.ontouchend=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerUp(e,t)},s.prototype._pointerUp=function(e,t){this._pointerDone(),this.pointerUp(e,t)},s.prototype.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t])},s.prototype._pointerDone=function(){this.isPointerDown=!1,delete this.pointerIdentifier,this._unbindPostStartEvents(),this.pointerDone()},s.prototype.pointerDone=i,s.prototype.onMSPointerCancel=s.prototype.onpointercancel=function(e){e.pointerId==this.pointerIdentifier&&this._pointerCancel(e,e)},s.prototype.ontouchcancel=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerCancel(e,t)},s.prototype._pointerCancel=function(e,t){this._pointerDone(),this.pointerCancel(e,t)},s.prototype.pointerCancel=function(e,t){this.emitEvent("pointerCancel",[e,t])},s.getPointerPoint=function(e){return{x:void 0!==e.pageX?e.pageX:e.clientX,y:void 0!==e.pageY?e.pageY:e.clientY}},s}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["eventie/eventie","unipointer/unipointer"],function(n,i){return t(e,n,i)}):"object"==typeof exports?module.exports=t(e,require("eventie"),require("unipointer")):e.Unidragger=t(e,e.eventie,e.Unipointer)}(window,function(e,t,n){"use strict";function i(){}function s(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function o(){}function r(){return!1}o.prototype=new n,o.prototype.bindHandles=function(){this._bindHandles(!0)},o.prototype.unbindHandles=function(){this._bindHandles(!1)};var a=e.navigator;o.prototype._bindHandles=function(e){e=void 0===e||!!e;var n;n=a.pointerEnabled?function(t){t.style.touchAction=e?"none":""}:a.msPointerEnabled?function(t){t.style.msTouchAction=e?"none":""}:function(){e&&u(r)};for(var i=e?"bind":"unbind",s=0,o=this.handles.length;s<o;s++){var r=this.handles[s];this._bindStartEvent(r,e),n(r),t[i](r,"click",this)}};var c="attachEvent"in document.documentElement,u=c?function(e){"IMG"==e.nodeName&&(e.ondragstart=r);for(var t=e.querySelectorAll("img"),n=0,i=t.length;n<i;n++){var s=t[n];s.ondragstart=r}}:i;o.prototype.pointerDown=function(n,i){if("INPUT"==n.target.nodeName&&"range"==n.target.type)return this.isPointerDown=!1,void delete this.pointerIdentifier;this._dragPointerDown(n,i);var s=document.activeElement;s&&s.blur&&s.blur(),this._bindPostStartEvents(n),this.pointerDownScroll=o.getScrollPosition(),t.bind(e,"scroll",this),this.emitEvent("pointerDown",[n,i])},o.prototype._dragPointerDown=function(e,t){this.pointerDownPoint=n.getPointerPoint(t);var i="touchstart"==e.type,o=e.target.nodeName;i||"SELECT"==o||s(e)},o.prototype.pointerMove=function(e,t){var n=this._dragPointerMove(e,t);this.emitEvent("pointerMove",[e,t,n]),this._dragMove(e,t,n)},o.prototype._dragPointerMove=function(e,t){var i=n.getPointerPoint(t),s={x:i.x-this.pointerDownPoint.x,y:i.y-this.pointerDownPoint.y};return!this.isDragging&&this.hasDragStarted(s)&&this._dragStart(e,t),s},o.prototype.hasDragStarted=function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3},o.prototype.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t]),this._dragPointerUp(e,t)},o.prototype._dragPointerUp=function(e,t){this.isDragging?this._dragEnd(e,t):this._staticClick(e,t)},n.prototype.pointerDone=function(){t.unbind(e,"scroll",this)},o.prototype._dragStart=function(e,t){this.isDragging=!0,this.dragStartPoint=o.getPointerPoint(t),this.isPreventingClicks=!0,this.dragStart(e,t)},o.prototype.dragStart=function(e,t){this.emitEvent("dragStart",[e,t])},o.prototype._dragMove=function(e,t,n){this.isDragging&&this.dragMove(e,t,n)},o.prototype.dragMove=function(e,t,n){s(e),this.emitEvent("dragMove",[e,t,n])},o.prototype._dragEnd=function(e,t){this.isDragging=!1;var n=this;setTimeout(function(){delete n.isPreventingClicks}),this.dragEnd(e,t)},o.prototype.dragEnd=function(e,t){this.emitEvent("dragEnd",[e,t])},o.prototype.pointerDone=function(){t.unbind(e,"scroll",this),delete this.pointerDownScroll},o.prototype.onclick=function(e){this.isPreventingClicks&&s(e)},o.prototype._staticClick=function(e,t){if(!this.isIgnoringMouseUp||"mouseup"!=e.type){var n=e.target.nodeName;if("INPUT"!=n&&"TEXTAREA"!=n||e.target.focus(),this.staticClick(e,t),"mouseup"!=e.type){this.isIgnoringMouseUp=!0;var i=this;setTimeout(function(){delete i.isIgnoringMouseUp},400)}}},o.prototype.staticClick=function(e,t){this.emitEvent("staticClick",[e,t])},o.prototype.onscroll=function(){var e=o.getScrollPosition(),t=this.pointerDownScroll.x-e.x,n=this.pointerDownScroll.y-e.y;(Math.abs(t)>3||Math.abs(n)>3)&&this._pointerDone()},o.getPointerPoint=function(e){return{x:void 0!==e.pageX?e.pageX:e.clientX,y:void 0!==e.pageY?e.pageY:e.clientY}};var l=void 0!==e.pageYOffset;return o.getScrollPosition=function(){return{x:l?e.pageXOffset:document.body.scrollLeft,y:l?e.pageYOffset:document.body.scrollTop}},o.getPointerPoint=n.getPointerPoint,o}),window.Keytrap=function(){"use strict";function e(e){var t=e.keyCode||e.which,n=[t];return e.shiftKey&&16!==e.keyCode&&n.push(16),e.ctrlKey&&17!==e.keyCode&&n.push(17),e.altKey&&18!==e.keyCode&&n.push(18),e.metaKey&&91!==e.keyCode&&n.push(91),n.sort(),n.join("+")}function t(e){return c[e]?c[e]:e.toUpperCase().charCodeAt(0)}function n(e){for(var n=e.split("+"),i=[],s=0;s<n.length;s++)i.push(t(n[s]));return i.sort(),i.join("+")}function i(e){for(var t=[],i=e.split(","),s=0;s<i.length;s++)t.push(n(i[s]));return t}function s(e,t){if(r[t]){for(var n=r[t],i=0;i<n.length;i++)n[i](e);if(a[t]&&e)return jQuery.Event(e).stopPropagation(),!1}}function o(t){return s(t,e(t))}var r={},a={},c={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,comctrl:17,alt:18,"":18,capslock:20,esc:27,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46,meta:91,command:91,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,'"':222};return navigator.appVersion.indexOf("Mac")!==-1&&(c.comctrl=91),$(document).on("keydown",o),{bind:function(e,t,n){for(var s=i(e),o=s.length-1;o>=0;o--)jQuery.isArray(r[s[o]])||(r[s[o]]=[]),r[s[o]].push(t),a[s[o]]=!!n},getKeyCode:function(e){return t(e)},getKeyEventID:function(t){return"string"==typeof t?n(t):e(t)},keyEventMatchesKeyCombo:function(t,i){return e(t)===n(i)},trigger:function(e,t){s(e,t)}}}(),function(){function e(e){AJAXUtil.get(t(e.grid_url),{},m)}function t(e){var t=e.split("?");return t.length>1?t[0]+"?"+t[1]+"&_cachebust="+(new Date).getTime():e+"?_cachebust="+(new Date).getTime()}function n(){A||(i(),A=!0)}function i(){s(),o(),l()}function s(){$("body").on("click","a.pagination-button",h)}function o(){Keytrap.bind("left",function(e){r(e,"prev")}),Keytrap.bind("right",function(e){r(e,"next")})}function r(e,t){var n=u();a(n,t)&&!c(e)&&p(n.grid_id,t)}function a(e,t){if(e){var n=$("#"+e.grid_id).find(".pagination-button[data-direction='"+t+"']");return n.length>0}return!1}function c(e){return _.include(["input","select","textarea"],e.target.tagName.toLowerCase())}function u(){return _.find(k,{page_is_main_grid:!0})}function l(){U.bind("popstate",d)}function d(e){e.originalEvent.state&&AJAXUtil.get(e.originalEvent.state,{},function(e){m(e,!1)})}function h(e){return e.preventDefault(),setTimeout(function(){var t=$(e.target).closest("a.pagination-button");p(t.data("grid-id"),t.data("direction"))},20),!1}function p(e,t){var n=f(e);AJAXUtil.get(n[t+"_grid_url"],{},m)}function f(e){return _.find(k,{grid_id:e})}function g(e){var t=v(e.grid_id);k[t]=e}function v(e){return _.findIndex(k,{grid_id:e})}function m(e,t){g(e.page),b(e.page),P(e.page,t),T(e),NastyBrowserSniffing.ios&&w()}function w(){$("a.loves, button.loves, span.loves").on("click",function(){})}function b(e){var t=$("#"+e.grid_id);t.html(e.html),C(e,t)}function C(e,t){if(!e.page_is_main_grid||CP.Page.firstTimeLoading)return void(CP.Page.firstTimeLoading=!1);var n=t.parent().offset().top;U.scrollTop()>n&&E.animate({scrollTop:n},x)}function P(e,t){if(e.page_is_main_grid&&S(e,t)){var n=e.page_url,i=window.location.hash;y(e.page_url)?(window.history.replaceState(e.grid_url,"",n),setTimeout(function(){window.location.hash=i},50)):(D?(window.history.replaceState(e.grid_url,"",n),setTimeout(function(){window.location.hash=i},50)):(window.history.pushState(e.grid_url,"",n),setTimeout(function(){window.location.hash=i},50)),D=!1)}}function y(e){var t=e.replace(window.location.pathname,"");return"/"===t}function S(e,t){return t="undefined"==typeof t||t,window.history.pushState&&t}function T(e){Hub.pub("grid-changed",e)}CP.Page={firstTimeLoading:!0},window.Page=CP.Page;var k=[],x=300,U=$(window),E=$("html, body");CP.Page.renderPages=function(t){n(),k=t,k.forEach(e)};var A=!1,D=!0}();var MarkdownButtons={addMarkDownButtons:function(e){e.markItUp(this._buttonSettings())},_buttonSettings:function(){return{previewParserPath:"",onShiftEnter:{keepDefault:!1,openWith:"\n\n"},markupSet:[{name:"Bold",key:"B",openWith:"**",closeWith:"**"},{name:"Italic",key:"I",openWith:"_",closeWith:"_"},{name:"Link",key:"L",openWith:"[",closeWith:']([![Url:!:http://]!] "[![Title]!]")',placeHolder:"Your text to link here..."},{name:"Quote",openWith:"> "},{name:"Inline Code",key:"",openWith:"`",closeWith:"`"},{name:"Block Code",replaceWith:function(e){var t=e.selection,n=t.split("\n"),i="\t"+n.join("\n\t");return i}}]}}};!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function i(){!e&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;e=!0;var o=new this;e=!1;for(var r in n)o[r]="function"==typeof n[r]&&"function"==typeof s[r]&&t.test(n[r])?function(e,t){return function(){var n=this._super;this._super=s[e];var i=t.apply(this,arguments);return this._super=n,i}}(r,n[r]):n[r];return i.prototype=o,i.prototype.constructor=i,i.extend=arguments.callee,i}}();var Love={_saveLoveToDBFunc:null,THROTTLE_DELAY:500,init:function(){_.extend(this,AJAXUtil),this.user=window.__user,this._bindToDOM(),this._createSaveLoveToDBFunc()},_createSaveLoveToDBFunc:function(){this._saveLoveToDBFunc=_.throttle(this._saveLoveChange,this.THROTTLE_DELAY,{leading:!1,trailing:!0})},_bindToDOM:function(){$("body").on("click","a.loves, button.loves, span.loves",$.proxy(this._onHeartClick,this))},_onHeartClick:function(e){if(e.preventDefault(),this._userNeedsToLogin())return this._redirectToLogin();var t=$(e.target).closest(".loves");this._isOwned(t)||this._heartItem(t)},_userNeedsToLogin:function(){return 1==this.user.id},_redirectToLogin:function(){window.location="/login?type=love"},_isOwned:function(e){return e.data("owned")},_heartItem:function(e){var t=this._getNextLevel(e);this._showAsHearted(e,t),this._saveLoveToDBFunc(e.data("item"),e.data("hashid"),t)},_getNextLevel:function(e){if(e.hasClass("comment-heart"))return this._isCommentedLoved(e)?0:1;var t=this._findTextLoveLevel(e.attr("class"));return this._nextLoveLevel(t)},_isCommentedLoved:function(e){return e.hasClass("love")},_findTextLoveLevel:function(e){var t=e.match(/loved-(\d)/);return t?1*t[1]:0},_nextLoveLevel:function(e){return 3===e?0:e+1},_showAsHearted:function(e,t){this._isHeartingComment(e)?this._showCommentHeartAsHearted(e,t):this._showStandardHeartAsHearted(e,t)},_isHeartingComment:function(e){return e.hasClass("comment-heart")},_showCommentHeartAsHearted:function(e,t){t>0?e.addClass("love loved-1"):e.removeClass("love loved-1"),this._updateLoveCount(e,t)},_showStandardHeartAsHearted:function(e,t){var n=e.data("hashid"),i=$("[data-hashid='"+n+"']");$.each(i,function(e,n){var i=$(n);if(!i.hasClass("count")){var s=i.hasClass("single-stat")?i:$(".heart-button");s.removeClass("loved-1 loved-2 loved-3 loved-0").attr("aria-pressed",!1).addClass("loved-"+t),0!=t&&s.attr("aria-pressed",!0),Love._updateLoveCount(s,t)}})},_updateLoveCount:function(e,t){var n=e.find("span.count"),i=this._getValueToAddToCount(t);n.html(this._getLoveCount(n,i))},_getValueToAddToCount:function(e){return 0===e?-1:1===e?1:0},_getLoveCount:function(e,t){var n=e.html();if(n){var i=1*n.replace(/[,\. ]/g,""),s=isNaN(i)?0:i;return s+=t,s>0?this._delimit(s):""}return""},_delimit:function(e,t){return t=t||",",e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)},_saveLoveChange:function(e,t,n){var i="/love/"+[e,t,n].join("/");this.post(i,{},function(){this._doneSaveLoveChange(e)})},_doneSaveLoveChange:function(e){"undefined"!=typeof Hub&&Hub.pub(e+"-hearted")}};Love.init(),function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof module&&module.exports?module.exports=t():e.lscache=t()}(this,function(){function e(){var e="__lscachetest__",n=e;if(void 0!==p)return p;try{if(!localStorage)return!1}catch(e){return!1}try{a(e,n),c(e),p=!0}catch(e){p=!(!t(e)||!localStorage.length)}return p}function t(e){return!!(e&&"QUOTA_EXCEEDED_ERR"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||"QuotaExceededError"===e.name)}function n(){return void 0===f&&(f=null!=window.JSON),f}function i(e){return e.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")}function s(e){return e+g}function o(){return Math.floor((new Date).getTime()/m)}function r(e){return localStorage.getItem(_+b+e)}function a(e,t){localStorage.removeItem(_+b+e),localStorage.setItem(_+b+e,t)}function c(e){localStorage.removeItem(_+b+e)}function u(e){for(var t=new RegExp("^"+_+i(b)+"(.*)"),n=localStorage.length-1;n>=0;--n){var o=localStorage.key(n);o=o&&o.match(t),o=o&&o[1],o&&o.indexOf(g)<0&&e(o,s(o))}}function l(e){var t=s(e);c(e),c(t)}function d(e){var t=s(e),n=r(t);if(n){var i=parseInt(n,v);if(o()>=i)return c(e),c(t),!0}}function h(e,t){C&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+e),t&&window.console.warn("lscache - The error was: "+t.message))}var p,f,_="lscache-",g="-cacheexpiration",v=10,m=6e4,w=Math.floor(864e13/m),b="",C=!1,P={set:function(i,d,p){if(e()&&n()){try{d=JSON.stringify(d)}catch(e){return}try{a(i,d)}catch(e){if(!t(e))return void h("Could not add item with key '"+i+"'",e);var f,_=[];u(function(e,t){var n=r(t);n=n?parseInt(n,v):w,_.push({key:e,size:(r(e)||"").length,expiration:n})}),_.sort(function(e,t){return t.expiration-e.expiration});for(var g=(d||"").length;_.length&&g>0;)f=_.pop(),h("Cache is full, removing item with key '"+i+"'"),l(f.key),g-=f.size;try{a(i,d)}catch(e){return void h("Could not add item with key '"+i+"', perhaps it's too big?",e)}}p?a(s(i),(o()+p).toString(v)):c(s(i))}},get:function(t){if(!e())return null;if(d(t))return null;var i=r(t);if(!i||!n())return i;try{return JSON.parse(i)}catch(e){return i}},remove:function(t){e()&&l(t)},supported:function(){return e()},flush:function(){e()&&u(function(e){l(e)})},flushExpired:function(){e()&&u(function(e){d(e)})},setBucket:function(e){b=e},resetBucket:function(){b=""},enableWarnings:function(e){C=e}};return P}),window.CacheGet={_inMemoryStore:{},find:function(e){this._validateOpts(e);var t=this._find(e);t?e.onSuccess(t):this._fetchAndCache(e)},_find:function(e){return this._inMemoryStore[e.key]?this._inMemoryStore[e.key]:lscache.get(e.key)},_validateOpts:function(e){if(!e.key)throw"Invalid key";if(!e.url)throw"Invalid URL";if(!e.onSuccess)throw"Invalid callback"},_fetchAndCache:function(e){var t=this;$.ajax({dataType:e.dataType||"text",url:e.url,
success:function(n){var i=n;"function"==typeof e.createCacheableResult&&(i=e.createCacheableResult(n)),t._inMemoryStore[e.key]=i,lscache.set(e.key,i,e.expire),e.onSuccess(i)}})}},lscache&&setTimeout(function(){lscache.flushExpired()},2500);var URLBuilder={getHostURL:function(e,t,n){var i=document.location,s=n?"https:":"",o=i.hostname,r=e?window.__CPDATA.host_secure_subdomain:"";r=void 0===typeof t?r:t;var a=i.port?":"+i.port:"",c="<%= protocol %>//<%= subdomain %><%= host %><%= port %>";return _.template(c,{protocol:s,subdomain:r,host:o,port:a})},getViewURL:function(e,t,n,i){return this.getViewURLSimple(e,t.base_url,n.getActiveSlugHash(),i)},getItemViewURL:function(e,t,n,i,s){return this.getItemViewURLSimple(e,t.base_url,n,i.getActiveSlugHash(),s)},getViewURLSimple:function(e,t,n,i,s){var o=URLBuilder.getHostURL(i,void 0,s);return o+=t+"/",o+=e+"/",o+=n+"/"},getItemViewURLSimple:function(e,t,n,i,s,o){var r=URLBuilder.getHostURL(s,void 0,o);return r+=t+"/",r+=n+"/",r+=e+"/",r+=i+"/"},SHORT_HOST:"https://cdpn.io",getShortViewURL:function(e,t){return e?[this.SHORT_HOST,e,t.getActiveSlugHash()].join("/"):[this.SHORT_HOST,t.getActiveSlugHash()].join("/")}},LocalDataLoader={latestObject:function(e,t,n){if(!n)return e;if("undefined"===n)return e;var i=$.parseJSON(n);return this._localStorageObjNewer(e,t,i)?i:e},_localStorageObjNewer:function(e,t,n){return this._getComparableClientTime(n,t)>t},_getComparableClientTime:function(e,t){var n=e.last_updated+"",i=t+"",s=n.substr(0,i.length);return+s}},PenScreenShotPreview={_showSelectors:[".all-forks .module"],_hideSelectors:[".all-forks .module",".preview"],$document:$(document),bindToPreview:function(){for(var e=0,t=this._showSelectors.length;e<t;e++)this.$document.on("mouseenter",this._showSelectors[e],this._showPreview);for(var n=0,i=this._hideSelectors.length;n<i;n++)this.$document.on("mouseleave",this._hideSelectors[n],this._hidePreview)},_showPreview:function(e){var t=$(e.target);$("#forks .preview").remove(),$("<div />",{id:"screenshot_preview_"+t.data("hashid"),"class":"preview",html:"<img src='"+t.data("preview")+"'>"}).appendTo(t)},_hidePreview:function(e){if($(this).hasClass("preview"))return $(this).remove(),!0;var t=$(e.target);t.find(".preview").remove()}},IDGenerator={length:8,generate:function(){for(var e=(+new Date).toString().split("").reverse(),t="",n=0;n<this.length;++n){var i=this._getRandomInt(0,e.length-1);t+=e[i]}return t},_getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}},User=Class.extend({recentScripts:{},init:function(){_.extend(this,__user)},isUserLoggedIn:function(){return+this.id>1},saveAccomplishment:function(e){AJAXUtil.post("/accomplishments",{name:e})},isAnon:function(){return+this.id<2},updateUser:function(e){_.extend(this,e)},addRecentSelectedScript:function(e){this.recentScripts[e.name]=e}}),Profiled=Class.extend({init:function(){_.extend(this,__profiled)},isUserProfiled:function(e){return!this.is_team&&e.username===this.username}}),UI={buildDefaultUIData:function(){return{info:"closed",layout:window.__layoutType||"top",editorViewSource:{html:!1,css:!1,js:!1},scrollTopLine:{html:{},css:{},js:{}},textSelection:{html:{start:{line:0,ch:0,xRel:0},end:{line:0,ch:0,xRel:0}},css:{start:{line:0,ch:0,xRel:0},end:{line:0,ch:0,xRel:0}},js:{start:{line:0,ch:0,xRel:0},end:{line:0,ch:0,xRel:0}}},editorSizes:{html:1/3,css:1/3,js:1/3,console:"closed"},settings:{pane:"closed",tab:"html",css:{addons:"closed"}}}}};!function(){function e(e,n){$.hideModal(),i(e),s(n),t()}function t(){AJAXUtil.put("/pens/transfer_pen/"+window.__item.id,{},n)}function n(e){window.history.replaceState({},document.title,e.url),location.reload()}function i(e){$("meta[name='csrf-token']").attr("content",e)}function s(e){window.__user=e,CP.user.updateUser(e)}function o(e){return!!e.origin.match(window.__CPDATA.host)&&"logged-into-codepen"===e.data.type}function r(e){return!!e.origin.match(window.__CPDATA.host)&&"redirect-to-login"===e.data.type}function a(e){e.preventDefault(),c(),$.hideModal()}function c(){$.cookie("always_save_as_anon","true",{expires:d,path:"/"})}function u(){return!(window.__user.id>1)&&(""!==window.__item.slug_hash&&(!(window.__item.user_id>1)&&(!$.cookie("always_save_as_anon")&&window.__save_as_anon_pen)))}function l(){return!(window.__user.id<2)&&(""!==window.__item.slug_hash&&(!(window.__item.user_id>1)&&window.__save_as_anon_pen))}_onMessage(function(t){o(t)&&e(t.data.csrf,t.data.user),r(t)&&(document.location="/login")});var d=7;$("body").on("click","#save-as-anon",a),u()&&$.showModal(_httpsFullURL("/accounts/anon/"),"modal-signup"),l()&&t()}();var Pen=Class.extend({id:"",title:"",description:"",slug_hash:"",html:"",css:"",js:"",parent:0,"private":!1,template:!1,html_pre_processor:"none",html_classes:"",head:"",css_pre_processor:"none",css_prefix:"neither",css_starter:"neither",js_pre_processor:"none",js_module:!1,tags:[],newTags:[],editor_settings:{},resources:[],save_disabled:!1,autosavingNow:!1,last_updated:"",updated_at:"",errorCode:"",saveAttempts:0,MAX_SAVE_ATTEMPTS:6,SAVE_ATTEMPT_TIMEOUT:1e4,fork:!1,lastSavedPen:{},redirectingToSavedURL:!1,init:function(){_.extend(this,AJAXUtil),_.extend(this,PenResourcesData),this._loadStoredData(),this._ensureDataIsValid()},_loadStoredData:function(){_.extend(this,__item,!0),this._ensureResourcesValid(),this.lastSavedPen=this._getSaveableCopyOfPen()},_ensureDataIsValid:function(){var e=new PenValidator;e.makePenValid(this),e.makePenValid(this.lastSavedPen)},setItemValue:function(e){e.item&&(e.pen=e.item);for(var t in e.pen)this._setValue(t,e.pen[t]);Hub.pub("pen-change",e)},_setValue:function(e,t){if(_.isObject(t)&&!_.isArray(t))for(var n in t)this[e][n]=t[n];else this[e]=t;this._updateLastUpdated()},_updateLastUpdated:function(){this.last_updated=(new Date).getTime()},getLastUpdatedAt:function(){return this.last_updated||new Date(this.updated_at).getTime()},getActiveSlugHash:function(){return this["private"]?this.slug_hash_private:this.slug_hash},getTags:function(){return _.uniq(_.clone(this.tags).concat(_.clone(this.newTags)))},getAttribute:function(e){return this[e]},newPen:function(){window.location="/pen"},save:function(){this.save_disabled||(this._canSave()?this._shouldForkPen()?this._forkPen():this._savePenToDB():Hub.pub("pen-errors",this.errorCode))},forkPenInCurrentState:function(){this.save_disabled||(this._canSave()?this._forkPen():Hub.pub("pen-errors",this.errorCode))},_shouldForkPen:function(){return this._isPenOwnedByAnotherUser()},saveAsPrivate:function(){this._canSave()?(this["private"]=!0,this._savePenToDB()):Hub.pub("pen-errors",this.errorCode)},MAX_PEN_SIZE:1e6,_canSave:function(){return!CP.user.isUserLoggedIn()&&this._isProfessorOrCollabSession()?(this.errorCode="anon-cannot-save-during-rt-session",!1):!(_lengthInUtf8Bytes(JSON.stringify(this._getSaveableCopyOfPen()))>this.MAX_PEN_SIZE)||(this.errorCode="pen-too-large",!1)},_isProfessorOrCollabSession:function(){return"professor"===__pageType||"collab"===__pageType},_forkPen:function(){this.fork=!0,this._savePenToDB()},_savePenToDB:function(){this._shouldSavePenToDB()?this.post("/pen/save",{pen:this._getSaveablePen()},this.doneSave,this.failedSave,this.erroredSave):this.sendPseudoSavedSignal()},_getSaveablePen:function(){return JSON.stringify(this.getCopyOfSaveablePen())},getCopyOfSaveablePen:function(){return this._updateSaveableTagsPriorToSave(),this._getSaveableCopyOfPen()},_shouldSavePenToDB:function(){return this.hasPenChanged()||this._isBlankNewPen()||this._isPenOwnedByAnotherUser()},_isBlankNewPen:function(){return""===this.slug_hash},_updateSaveableTagsPriorToSave:function(){this.tags=this.getTags(),this.newTags=[]},sendPseudoSavedSignal:function(){Hub.pub("pen-saved",{})},doneSave:function(e){this.saveAttempts=0;var t=this._getDiffPen(this,this.lastSavedPen);if(this.lastSavedPen=this._getSaveableCopyOfPen(),e.new_pen_saved)if(this._isProfessorOrCollabSession()){var n={newPen:!0,url:e.redirect_url,pen:t};Hub.pub("pen-saved",n)}else Hub.pub("save-editor-sizes",e.slug_hash),CPLocalStorage.setItem(e.slug_hash,"new-pen"),this.redirectingToSavedURL=!0,window.location=this._getFullRedirectURL(e);else Hub.pub("pen-saved",{pen:t,last_saved_time_ago:e.last_saved_time_ago})},_getFullRedirectURL:function(e){var t=document.location.href.split("?");return t.length>1?this._stripQuestionMarkInURL(e.redirect_url+"?"+this._stripTemplateQueryPart(t[1])):e.redirect_url},_stripTemplateQueryPart:function(e){return(e||"").replace(/template=\w+/,"")},_stripQuestionMarkInURL:function(e){return e.replace(/\?$/,"")},failedSave:function(e){this.showStandardErrorMessage(e)},erroredSave:function(){if(this.saveAttempts+=1,this.saveAttempts<this.MAX_SAVE_ATTEMPTS){var e=_.template(Copy.errors["unable-to-save-try-again"],{time:TimeUtil.countToString(this.saveAttempts)});$.showMessage(e,"super-slow"),setTimeout($.proxy(this._savePenToDB,this),this.SAVE_ATTEMPT_TIMEOUT)}else this.saveAttempts=0,$.showMessage(Copy.errors["unable-to-save-ever"],"super-slow")},isUserPenOwner:function(){return""===this.slug_hash||(CP.profiled.is_team?CP.profiled.id===CP.user.current_team_id:CP.user.isAnon()?this.session_hash===CP.user.session_hash:CP.profiled.id===CP.user.id)},_isPenOwnedByAnotherUser:function(){return!this.isUserPenOwner()},hasPenChanged:function(){return _.size(this._getDiffPen(this,this.lastSavedPen))>0},hasPenContentChanged:function(){const e=this._getDiffPen(this,this.lastSavedPen);return delete e.editor_settings,_.size(e)>0},_getDiffPen:function(e,t){return _diffObjects(t,e)},_getSaveableCopyOfPen:function(){return _.reduce(this._getDataRelevantAttributes(),function(e,t){return e[t]=_.cloneDeep(this[t]),e},{},this)},_getDataRelevantAttributes:function(){return["id","user_id","team_id","slug_hash","slug_hash_private","title","description","tags","newTags","resources","editor_settings","fork","private","parent","template","html","html_pre_processor","html_classes","head","css","css_pre_processor","css_prefix","css_starter","js","js_pre_processor","js_module"]},getAttributesThatAffectPenPreview:function(){return["html","css","js","html_pre_processor","html_classes","head","css_pre_processor","css_prefix","css_starter","js_pre_processor","js_module","resources"]},liveViewPopout:function(){window.open($("#live-link").attr("href")),CP.CodeEditorsResizeView.setEditorSizes({editor:"1"})}}),PenAutosave=Class.extend({autoSaveFunc:null,AUTOSAVE_TIMER:2e4,_showedUserAutoSaveOnMessage:!1,_hasUserEverSaved:!1,_mobile:!1,liveChangesWOSave:0,saveButton:$("#save, #update"),init:function(){this._mobile=window.__mobile,this.autoSaveFunc=_.debounce(this._saveViaAutoSave,this.AUTOSAVE_TIMER),this._bindToHub(),this._startAutoSave()},_bindToHub:function(){Hub.sub("live_change",$.proxy(this._onLiveChange,this)),Hub.sub("pen-saved",$.proxy(this._onSaved,this))},_startAutoSave:function(){this._penCanBeAutosaved()&&this._conditionallyShowAutosavingNowMessage()},_onLiveChange:function(){this._penCanBeAutosaved()?this._handleAutoSave():this._handleNonAutoSave()},_handleAutoSave:function(){this.autoSaveFunc()},_saveViaAutoSave:function(){this._autoSavePenRightNow()&&(CP.pen.autosavingNow=!0,CP.pen.save())},_autoSavePenRightNow:function(){return!CP.settingsController.settingsPaneVisible()},_handleNonAutoSave:function(){return!(!CP.pen.isUserPenOwner()||CP.pen.save_disabled)&&(this.liveChangesWOSave+=1,this.saveButton.removeClass("unsaved-wobble unsaved-grow"),6===this.liveChangesWOSave&&this.saveButton.addClass("unsaved-wobble"),11===this.liveChangesWOSave&&this.saveButton.addClass("unsaved-grow"),16===this.liveChangesWOSave&&$.showMessage("There have been 15 changes without a save. Remember to save your work!","slow"),void(21===this.liveChangesWOSave&&this.saveButton.addClass("unsaved-wobble")))},_onSaved:function(){this._hasUserEverSaved=!0,this._showPenSavedMessage(),this._conditionallyShowAutosavingNowMessage()},_showPenSavedMessage:function(){CP.pen.autosavingNow||$.showMessage(Copy.penUpdated),CP.pen.autosavingNow=!1},_conditionallyShowAutosavingNowMessage:function(){this._showedUserAutoSaveOnMessage||this._penCanBeAutosaved()&&this._showAutoSaveOnMessage()},_showAutoSaveOnMessage:function(){this._showedUserAutoSaveOnMessage=!0,setTimeout(function(){$.showMessage(Copy.autoSavingNow,"slow")},1500)},_penCanBeAutosaved:function(){return!!this._userInitiatedSavePreviously()&&(CP.user.isUserLoggedIn()&&CP.pen.editor_settings.auto_save&&CP.pen.getActiveSlugHash().length>0&&!this._mobile)},_userInitiatedSavePreviously:function(){return this._referredFromNewPen()||this._hasUserEverSaved},_referredFromNewPen:function(){return!!document.referrer.match(/\/pen(\/)?$/)}}),PenDelete=Class.extend({init:function(){_.extend(this,AJAXUtil),this._bindToDOM()},_bindToDOM:function(){$(".delete-button")._on("click",this._deletePen,this)},_deletePen:function(){$.showModal("/ajax/confirm_pen_delete","modal-warning",$.proxy(this._deletePenModalCallback,this))},_deletePenModalCallback:function(){$("#confirm-delete")._on("click",this._confirmDeletePen,this)},_confirmDeletePen:function(){this.del("/pen/"+CP.pen.slug_hash,{},this._doneDelete),$.showMessage(Copy.deletingPen,"super-slow")},_doneDelete:function(){CPLocalStorage.setItem("pen_deleted",JSON.stringify({penID:CP.pen.id,activeSlugHash:CP.pen.getActiveSlugHash()})),CP.penSaver.skipWarning=!0,window.location=this._getURLToReturnTo()},_getURLToReturnTo:function(){return CP.profiled.base_url+"/pens/"+this._getProfilePageToReturnTo()+"/"},_getProfilePageToReturnTo:function(){var e="public",t=document.referrer.match(/(?:\/([^\/]+)\/?)$/);if(t){var n=t[1];_.contains(this._possibleProfilePagesToReturnTo(),n)&&(e=n)}return e},_possibleProfilePagesToReturnTo:function(){return["popular","public","private","forked","tags"]}}),PenResourcesData={MIN_RESOURCES:2,setResource:function(e,t){this._setResourceURL(_.find(this.resources,{view_id:e}),t),this._postResourceChange()},updateResourcesOrder:function(e,t){this._updateResourcesOrder(e,t),this._postResourceChange()},addEmptyResource:function(e){this._addNewResource(e,""),this._postResourceChange()},quickAddResource:function(e,t){this._quickAddResource(e,t),this._postResourceChange(!0)},deleteResource:function(e){this._deleteResource(e),this._postResourceChange()},getResourcesByType:function(e){return _.select(this.resources,{resource_type:e})},setPenResources:function(e){this.resources=e.pen.resources,this._postResourceChange()},_ensureResourcesValid:function(){this._ensureMinNumberOfResourcesForEachType(),this._storeResourcesByOrder(),this._ensureResourcesHaveViewIDs(),this._ensureResourcesHaveActions()},_ensureMinNumberOfResourcesForEachType:function(){this._ensureMinNumberOfResourcesForType("css"),this._ensureMinNumberOfResourcesForType("js")},_ensureMinNumberOfResourcesForType:function(e){_.times(this.MIN_RESOURCES-this.getResourcesByType(e).length,function(){this.resources.push({resource_type:e,order:0,url:""})},this)},_ensureResourcesHaveViewIDs:function(){_.forEach(this.resources,function(e){_.isUndefined(e.view_id)&&(e.view_id=IDGenerator.generate())})},_ensureResourcesHaveActions:function(){_.forEach(this.resources,function(e){_.isUndefined(e.action)&&(e.action="include_"+e.resource_type+"_url")})},_postResourceChange:function(e){this._updateLastUpdated(),this._ensureResourcesValid(),this._publishResourcePenChange(e)},_quickAddResource:function(e,t){var n=_.find(this.getResourcesByType(e),{url:""});n?this._setResourceURL(n,t):this._addNewResource(e,t)},_setResourceURL:function(e,t){e.url=t.replace(/\s+/,"")},_updateResourcesOrder:function(e,t){for(var n=0,i=this.resources.length;n<i;n++)this.resources[n].resource_type===e&&(this.resources[n].order=t[this.resources[n].view_id]);this._storeResourcesByOrder()},_storeResourcesByOrder:function(){this.resources=_.sortBy(this.resources,"order")},_addNewResource:function(e,t){var n=_.reduce(this.resources,function(t,n){return n.resource_type===e&&n.order>t&&(t=n.order),n},0);this.resources.push({resource_type:e,order:n+1,url:t||"",view_id:IDGenerator.generate(),action:"include_"+e+"_url"})},_deleteResource:function(e){_removeFromArrayByIndex(this.resources,_.findIndex(this.resources,{view_id:e}))},_publishResourcePenChange:function(e){Hub.pub("pen-change",{origin:"client",rebind:e,pen:{resources:_.clone(this.resources)}})}},PenSaver=Class.extend({init:function(){this.pageType=__pageType,this._warnAboutLostChanges()},potentialLostWork:function(){return this._shouldWarnAboutLostWork()},_warnAboutLostChanges:function(){window.onbeforeunload=$.proxy(function(){if(!this.skipWarning)return this._shouldWarnAboutLostWork()?Copy.youHaveUnsavedChanges:void 0},this)},_shouldWarnAboutLostWork:function(){var e=CP.pen.hasPenContentChanged();return"professor"===this.pageType?e&&this._isProfessorInProfessorRoom():"collab"===this.pageType?e&&this._isPenOwnerInCollabRoom():e&&!CP.pen.redirectingToSavedURL&&!CP.pen.save_disabled},_isProfessorInProfessorRoom:function(){var e=!1;return"professor"===this.pageType&&"undefined"!=typeof CP.professor&&(e=!0),e},_isPenOwnerInCollabRoom:function(){return"collab"===this.pageType&&CP.pen.isUserPenOwner()}}),LocalDataValidator={makeObjValid:function(e,t){for(var n in e)t[n]&&(e[n]=this._getValidAttributeValue(t,n,e[n]))},_getValidAttributeValue:function(e,t,n){var i=e[t];return"array"===i["typeof"]?this._getValidArrayType(n,i):_.isArray(i["typeof"])?this._getValidArrayAttributeValue(n,i):this._getValidSimpleAttributeValue(n,i)},_getValidArrayType:function(e,t){return _.isArray(e)?e:t["default"]},_getValidArrayAttributeValue:function(e,t){return _.contains(t["typeof"],e)?e:t["default"]},_getValidSimpleAttributeValue:function(e,t){return typeof e===t["typeof"]?e:t["default"]}},PenValidator=Class.extend({dataAttributes:{title:{"typeof":"string","default":""},description:{"typeof":"string","default":""},slug_hash:{"typeof":"string","default":""},html:{"typeof":"string","default":""},css:{"typeof":"string","default":""},js:{"typeof":"string","default":""},parent:{"typeof":"number","default":0},"private":{"typeof":"boolean","default":!1},template:{"typeof":"boolean","default":!1},js_module:{"typeof":"boolean","default":!1},html_pre_processor:{"typeof":__preprocessors.html.syntaxes,"default":__preprocessors.html["default"]},html_classes:{"typeof":"string","default":""},head:{"typeof":"string","default":""},css_pre_processor:{"typeof":__preprocessors.css.syntaxes,"default":__preprocessors.css["default"]},css_prefix:{"typeof":__preprocessors.css.prefixes,"default":__preprocessors.css.default_prefix},css_starter:{"typeof":__preprocessors.css.bases,"default":__preprocessors.css.default_base},styles:{"typeof":"array","default":[]},js_pre_processor:{"typeof":__preprocessors.js.syntaxes,"default":__preprocessors.js["default"]},scripts:{"typeof":"array","default":[]}},makePenValid:function(e){LocalDataValidator.makeObjValid(e,this.dataAttributes)}}),Project=Class.extend({id:"",title:"",description:"",slug_hash:"",parent:0,"private":!1,template:!1,tags:[],newTags:[],init:function(){_.extend(this,AJAXUtil),this._loadStoredData(),this._ensureDataIsValid()},_loadStoredData:function(){_.extend(this,__item,!0)},_ensureDataIsValid:function(){},getActiveSlugHash:function(){return this["private"]?this.slug_hash_private:this.slug_hash},getURLSlugHash:function(){return this["private"]?this.slug_hash_private+"/"+this.slug_hash:this.slug_hash},getTags:function(){return _.uniq(_.clone(this.tags).concat(_.clone(this.newTags)))},setItemValue:function(e){for(var t in e.item)this._setValue(t,e.item[t])},_setValue:function(e,t){if(_.isObject(t)&&!_.isArray(t))for(var n in t)this[e][n]=t[n];else this[e]=t},_updateSaveableTagsPriorToSave:function(){this.tags=this.getTags(),this.newTags=[]},saveDetails:function(){this._updateSaveableTagsPriorToSave(),this.put("/projects/project/"+this.slug_hash,{_isJSON:!0,json:{payload:{project:{id:this.id,title:this.title,description:this.description,project_files_attributes:[],"private":this["private"],tags:this.tags}}}},this._saveComplete)},_saveComplete:function(){this._updateBrowserURL(),CP.SettingsModel.hideSettingsPane(),location.reload()},_updateBrowserURL:function(){if(window.history.replaceState&&CP.item.getActiveSlugHash()){var e=URLBuilder.getItemViewURL("details",CP.profiled,CP.itemType,CP.item,!1);window.history.replaceState(e,"",e)}},forkProject:function(){this.post("/projects/fork",{_isJSON:!0,json:{source:this.slug_hash}},this._successfulFork)},_successfulFork:function(e){var t=e.payload.project.url;window.location=t}}),BaseSettingsController=Class.extend({setItemValue:function(e){this.item||(this.item=this.pen),this.item.setItemValue(e)},syncWithServer:function(e){this.model.syncWithServer(e)}}),BaseSettingsEvents=Class.extend({type:"",_canDrive:!0,init:function(e){this.controller=e,_.extend(this,EnableDisableDriver),this.bindToEnableDisableHubEvents()},_setItemValue:function(e){this.controller.setItemValue(this._buildBasicData(e))},_setItemValueFromServer:function(e){this.controller.setItemValue(e)},_onServerPenChange:function(e,t){this.controller.setItemValue(t)},_buildBasicData:function(e){return{origin:"client",pen:e}}}),BaseSettingsModel=Class.extend({init:function(){}}),BaseSettingsView=Class.extend({type:"",_canDrive:!0,init:function(){}}),BehaviorController=BaseSettingsController.extend({init:function(e){this.pen=e,this.events=new BehaviorEvents(this),this.view=new BehaviorView(e)}}),BehaviorEvents=BaseSettingsEvents.extend({$autoSave:$("#auto-save"),$autoRun:$("#auto-run"),$tabSize:$("#tab-size"),$indentWith:$("input[name='indent-with']"),init:function(e){this._super(e),_.extend(this,EnableDisableDriver),this.bindToEnableDisableHubEvents(),this._bindToDOM(),this._bindToHub()},_bindToDOM:function(){this.$autoSave._on("click",this._setAutoSave,this,!0),this.$autoRun._on("click",this._setAutoRun,this,!0),this.$tabSize._on("change",this._onTabSizeChange,this),this.$indentWith._on("click",this._setIndentWith,this,!0)},_bindToHub:function(){Hub.sub("server-pen-change",$.proxy(this._onServerPenChange,this))},_onServerPenChange:function(e,t){ObjectUtil.hasNestedValue(t,"pen.editor_settings")&&this._setItemValueFromServer(t)},_setAutoSave:function(e,t){this._canDrive&&this._setItemValue(this._buildSettingsPenData("auto_save",t.is(":checked")))},_setAutoRun:function(e,t){this._canDrive&&this._setItemValue(this._buildSettingsPenData("auto_run",t.is(":checked")))},_setIndentWith:function(){this._canDrive&&this._setItemValue(this._buildSettingsPenData("indent_with",$("input[name='indent-with']:checked").val()))},_onTabSizeChange:function(e,t){this._canDrive&&this._setItemValue(this._buildSettingsPenData("tab_size",this._validTabSize(t.val())))},_validTabSize:function(e){var t=1*e;return t<1||t>6?"1":e},_buildSettingsPenData:function(e,t){var n={editor_settings:{}};return n.editor_settings[e]=t,n},_getAllUIElements:function(){return[this.$autoSave,this.$autoRun,this.$tabSize,this.$indentWith]}}),BehaviorView=Class.extend({$body:$("body"),$autoSave:$("#auto-save"),$autoRun:$("#auto-run"),$tabSize:$("#tab-size"),$indentWithSpaces:$("#indent-with-spaces"),$indentWithTabs:$("#indent-with-tabs"),init:function(e){this._bindToHub(),this._handlePenChange(e)},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this))},_onPenChange:function(e,t){this._handlePenChange(t.pen)},_handlePenChange:function(e){ObjectUtil.hasNestedValue(e,"editor_settings.auto_run")&&this._setAutoRun(e.editor_settings.auto_run),ObjectUtil.hasNestedValue(e,"editor_settings.auto_save")&&this._setAutoSave(e.editor_settings.auto_save),ObjectUtil.hasNestedValue(e,"editor_settings.indent_with")&&this._setIndentWith(e.editor_settings.indent_with),ObjectUtil.hasNestedValue(e,"editor_settings.tab_size")&&this._setTabSize(e.editor_settings.tab_size)},_setAutoRun:function(e){e?(this.$autoRun.prop("checked",!0),this.$body.removeClass("show-run-button")):(this.$autoRun.prop("checked",!1),this.$body.addClass("show-run-button"))},_setAutoSave:function(e){this.$autoSave.prop("checked",e)},_setIndentWith:function(e){"tabs"===e?(this.$indentWithTabs.prop("checked",!0),this.$indentWithSpaces.prop("checked",!1)):(this.$indentWithTabs.prop("checked",!1),this.$indentWithSpaces.prop("checked",!0))},_setTabSize:function(e){this.$tabSize.val(e)}}),CSSSettingsController=BaseSettingsController.extend({init:function(e){this.pen=e,this.events=new CSSSettingsEvents(this),this.model=new CSSSettingsModel,this.view=new CSSSettingsView(e),this.resourcesController=new ResourcesController("css")},showAddons:function(e){this.model.showAddons(e)},hideAddons:function(e){this.model.hideAddons(e)},syncWithServer:function(e){this.model.syncWithServer(e)}}),CSSSettingsEvents=BaseSettingsEvents.extend({type:"css",$cssPreProcessor:$("#css-preprocessor"),$starterCSS:$("input[name='startercss']"),$cssPrefix:$("input[name='prefix']"),$cssNeedAnAddon:$("#css-need-an-addon-button"),init:function(e){this._super(e),_.extend(this,EnableDisableDriver),this.bindToEnableDisableHubEvents(),this._bindToDOM(),this._bindToHub()},_bindToDOM:function(){this.$cssPreProcessor._on("change",this._selectPreProcessor,this,!0),this.$starterCSS._on("click",this._selectStartCSS,this,!0),this.$cssPrefix._on("click",this._selectCSSPrefix,this,!0),this.$cssNeedAnAddon._on("click",this._onClickNeedAnAddonButton,this)},_bindToHub:function(){Hub.sub("server-ui-change",$.proxy(this._onServerUIChange,this)),Hub.sub("server-pen-change",$.proxy(this._onServerPenChange,this))},_onServerUIChange:function(e,t){ObjectUtil.hasNestedValue(t,"ui.settings.css.addons")&&this.controller.syncWithServer(t)},_onServerPenChange:function(e,t){(ObjectUtil.hasNestedValue(t,"pen.css_pre_processor")||ObjectUtil.hasNestedValue(t,"pen.css_prefix")||ObjectUtil.hasNestedValue(t,"pen.css_starter"))&&this._setItemValueFromServer(t)},_selectPreProcessor:function(e,t){this._canDrive&&(this._setItemValue({css_pre_processor:t.val()}),this.controller.hideAddons({origin:"client"}))},_selectStartCSS:function(e,t){this._canDrive&&this._setItemValue({css_starter:t.val()})},_selectCSSPrefix:function(e,t){this._canDrive&&this._setItemValue({css_prefix:t.val()})},_getAllUIElements:function(){return[this.$cssPreProcessor,this.$starterCSS,this.$cssPrefix,this.$cssNeedAnAddon]},_onClickNeedAnAddonButton:function(){this._canDrive&&("open"==CP.ui.settings.css.addons?this.controller.hideAddons({origin:"client"}):this.controller.showAddons({origin:"client"}))}}),CSSSettingsModel=BaseSettingsModel.extend({type:"css",init:function(){this._super()},showAddons:function(e){CP.ui.settings.css.addons="open",this._pubUIChange(e)},hideAddons:function(e){CP.ui.settings.css.addons="closed",this._pubUIChange(e)},syncWithServer:function(e){CP.ui.settings.css.addons=e.ui.settings.css.addons,this._pubUIChange(e)},_pubUIChange:function(e){Hub.pub("ui-change",{origin:e.origin,ui:{settings:{css:{addons:CP.ui.settings.css.addons}}}})}}),CSSSettingsView=BaseSettingsView.extend({$boxCSSEl:$("#box-css"),$cssPreprocessor:$("#css-preprocessor"),$needAnAddon:$("#need-an-addon"),$addOns:$("#add-ons"),type:"css",init:function(e){this._super(),this._bindToHub(),this._updateUI(e)},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this)),Hub.sub("ui-change",$.proxy(this._onUIChange,this))},_onPenChange:function(e,t){this._updateUI(t.pen)},_updateUI:function(e){ObjectUtil.hasNestedValue(e,"css_pre_processor")&&this._setPreProcessor(e),ObjectUtil.hasNestedValue(e,"css_starter")&&this._selectCSSStarter(e),ObjectUtil.hasNestedValue(e,"css_prefix")&&this._selectCSSPrefix(e)},_onUIChange:function(e,t){ObjectUtil.hasNestedValue(t,"ui.settings.css.addons")&&this._updateAddons(t.ui.settings.css.addons)},_setPreProcessor:function(e){this._selectPreProcessor(e),this._addClassesToBoxCSS(e),this._toggleNeedAddons(e)},_selectPreProcessor:function(e){this.$cssPreprocessor.val(e.css_pre_processor)},_addClassesToBoxCSS:function(e){this.$boxCSSEl.data("preprocessor",__preprocessors.css.pretty_syntaxes[e.css_pre_processor]),this.$boxCSSEl.removeClass(__preprocessors.css.syntaxes.join(" ")).removeClass(__preprocessors.css.prefixes.join(" ")).addClass(e.css_pre_processor)},_toggleNeedAddons:function(e){if(_.contains(__preprocessors.css.preprocessors,e.css_pre_processor)){var t=this;CacheGet.find({key:"/editor/constants/addons/"+e.css_pre_processor,url:"/editor/constants/addons/"+e.css_pre_processor,dataType:"json",onSuccess:function(e){t.$addOns.html(e.html),t.$needAnAddon.removeClass("hide"),t._bindToAddOnsDOM()}})}else this.$needAnAddon.addClass("hide")},_bindToAddOnsDOM:function(){this.$addOnFilter=$("#css-add-ons-filter"),this.$addOnFilter._on("keyup",this._filterAddOns,this),this.$addOnFilterClear=$("#css-clear-addon-filter"),this.$addOnFilterClear._on("click",this._clearAddOnsFilter,this),this.$addOnItems=$("#css-add-ons-list").find("li"),this.$addOnItems.find(".add-add-on")._on("click",this._insertAddOnCode,this)},_insertAddOnCode:function(e,t){e.preventDefault();var n=CP.cssEditor.editor.getValue(),i=t.parent().find(".add-on-code").html()+"\n"+n;CP.cssEditor.editor.setValue(i),$.showMessage("Preprocessor Add-On Added!")},_updateAddons:function(e){"open"===e?this.$addOns.removeClass("hide"):this.$addOns.addClass("hide")},_selectCSSStarter:function(e){$("#startercss-options-form input[value='"+e.css_starter+"']").prop("checked",!0)},_selectCSSPrefix:function(e){$("#prefix-options-form input[value='"+e.css_prefix+"']").prop("checked",!0),this._addCSSPrefixClassToBoxCSS(e)},_addCSSPrefixClassToBoxCSS:function(e){this.$boxCSSEl.removeClass(__preprocessors.css.prefixes.join(" ")).addClass(e.css_prefix)},_filterAddOns:function(){var e=this.$addOnFilter.val();if(""!==e){this.$addOnItems.hide(),this.$addOnFilterClear.show();for(var t=0;t<this.$addOnItems.length;t++)if(this.$addOnItems[t].innerHTML.indexOf(e)>-1&&($(this.$addOnItems[t]).show(),$(this.$addOnItems[t]).hasClass("depends-on")))for(var n=t;n>=0;n--)if(!$(this.$addOnItems[n]).hasClass("depends-on")){$(this.$addOnItems[n]).show();break}}else this.$addOnFilterClear.hide(),this.$addOnItems.show()},_clearAddOnsFilter:function(){this.$addOnFilter.val(""),this.$addOnItems.show(),this.$addOnFilterClear.hide()}});!function(){CP.headerController={},CP.headerController.init=function(){CP.headerEvents.init(),CP.headerView.init()}}(),function(){function e(){r.on("click",n)}function t(){o=$(".inline-title-input"),o.on("keydown",i),o.on("blur",s)}function n(){CP.headerView.enterEditMode(),setTimeout(function(){t();var e=o.val();o.val(""),o.focus(),o.val(e)},0)}function i(e){if(e.keyCode)switch(e.keyCode){case 13:o.blur();break;case 27:CP.headerView.cancelEditMode()}}function s(){CP.headerView.savePenTitle()}var o,r=($("#pen-title"),$(".edit-pen-title"));CP.headerEvents={},CP.headerEvents.init=function(){e()}}(),function(){function e(){n=$("<input class='inline-title-input' type='text' maxlength='255' />"),n.val(CP.pen.title),i.append(n),n.focus(),n[0].setSelectionRange(CP.pen.title.length,CP.pen.title.length)}function t(e){CP.item.setItemValue({origin:"client",pen:{title:e}})}var n,i=$("#pen-title"),s=$(".item-details-title");CP.headerView={},CP.headerView.init=function(){},CP.headerView.enterEditMode=function(){i.closest(".pen-title-area").addClass("editing"),e()},CP.headerView.cancelEditMode=function(){n.remove(),n=null,i.closest(".pen-title-area").removeClass("editing")},CP.headerView.savePenTitle=function(){var e=n.val();CP.headerView.cancelEditMode(),t(e),""!==CP.pen.slug_hash&&setTimeout(function(){CP.pen.save(),s.length&&s.val(e)},1)}}();var HTMLSettingsController=BaseSettingsController.extend({init:function(e){this.pen=e,this.events=new HTMLSettingsEvents(this),this.model=new HTMLSettingsModel(this),this.view=new HTMLSettingsView(e)}}),HTMLSettingsEvents=BaseSettingsEvents.extend({type:"html",$htmlPreProcessor:$("#html-preprocessor"),$headContent:$("#head-content"),$htmlClasses:$("#html-classes"),$metaTagInsert:$("#meta-tag-insert"),init:function(e){this._super(e),_.extend(this,EnableDisableDriver),this.bindToEnableDisableHubEvents(),this._bindToDOM(),this._bindToHub()},_bindToDOM:function(){this.$htmlPreProcessor._on("change",this._selectPreProcessor,this,!0),this.$headContent._on("keyup change",this._setHead,this,!0),this.$htmlClasses._on("keyup change",this._setHTMLClasses,this,!0),this.$metaTagInsert._on("click",this._addCommonMetaTag,this,!1)},_bindToHub:function(){Hub.sub("server-pen-change",$.proxy(this._onServerPenChange,this))},_onServerPenChange:function(e,t){(ObjectUtil.hasNestedValue(t,"pen.html_pre_processor")||ObjectUtil.hasNestedValue(t,"pen.head")||ObjectUtil.hasNestedValue(t,"pen.html_classes"))&&this._setItemValueFromServer(t)},_selectPreProcessor:function(e,t){this._canDrive&&this._setItemValue({html_pre_processor:t.val()})},_setHead:function(e,t){
this._canDrive&&this._setItemValue({head:t.val()})},_setHTMLClasses:function(e,t){this._canDrive&&this._setItemValue({html_classes:t.val()})},_addCommonMetaTag:function(){this._canDrive&&this._setItemValue({head:this._getHeadWithMetaTag()})},_getHeadWithMetaTag:function(){return $.trim($("#head-content").val()+'\n<meta name="viewport" content="width=device-width, initial-scale=1">')},_getAllUIElements:function(){return[this.$htmlPreProcessor,this.$headContent,this.$htmlClasses,this.$metaTagInsert]}}),HTMLSettingsModel=BaseSettingsModel.extend({type:"html",init:function(){this._super()}}),HTMLSettingsView=BaseSettingsView.extend({$boxHTML:$("#box-html"),$htmlPreprocessor:$("#html-preprocessor"),$htmlClasses:$("#html-classes"),$headWrapper:$(".head-content-wrapper"),$head:$("#head-content"),type:"html",init:function(e){this._super(),this._bindToHub(),this._updateUI(e)},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this))},_onPenChange:function(e,t){this._updateUI(t.pen)},_updateUI:function(e){ObjectUtil.hasNestedValue(e,"html_pre_processor")&&this._setPreProcessor(e.html_pre_processor),ObjectUtil.hasNestedValue(e,"head")&&this._setHead(e.head),ObjectUtil.hasNestedValue(e,"html_classes")&&this._setHTMLClasses(e.html_classes)},_setHead:function(e){this.$head.val()!==e&&this.$head.val(e),e.indexOf("http://")!==-1?this.$headWrapper.addClass("insecure-resource"):this.$headWrapper.removeClass("insecure-resource")},_setHTMLClasses:function(e){this.$htmlClasses.val()!==e&&this.$htmlClasses.val(e)},_setPreProcessor:function(e){this._addClassBoxHTML(e),this._selectPreProcessor(e)},_selectPreProcessor:function(e){this.$htmlPreprocessor.val(e)},_addClassBoxHTML:function(e){this.$boxHTML.data("preprocessor",__preprocessors.html.pretty_syntaxes[e]),this.$boxHTML.removeClass(__preprocessors.html.syntaxes.join(" ")).addClass(e)}}),InfoController=Class.extend({init:function(){this.events=new InfoEvents,this.view=new InfoView}}),InfoEvents=Class.extend({$title:$("#item-details-title"),$description:$("#item-details-description"),$privateCkbx:$("#item-details-private"),$passwordCkbx:$("#item-details-password"),$templateCkbx:$("#item-details-template"),init:function(e){this.controller=e,this._bindToDOM()},_bindToDOM:function(){this.$title.on("keyup",$.proxy(this._setTitle,this)),this.$description.on("keyup",$.proxy(this._setDescription,this)),this.$privateCkbx._on("click",this._setPrivacy,this,!0),this.$passwordCkbx._on("click",this._setPasswordUsage,this,!0),this.$templateCkbx._on("click",this._setTemplate,this,!0)},_setTitle:function(){CP.item.setItemValue({origin:"client",item:{title:this.$title.val()}})},_setDescription:function(){CP.item.setItemValue({origin:"client",item:{description:this.$description.val()}})},_setPrivacy:function(){CP.item.setItemValue({origin:"client",item:{"private":this.$privateCkbx.is(":checked")}})},_setPasswordUsage:function(){CP.item.setItemValue({origin:"client",item:{password_used:this.$passwordCkbx.is(":checked")}})},_setTemplate:function(){CP.item.setItemValue({origin:"client",item:{template:this.$templateCkbx.is(":checked")}})}}),InfoView=Class.extend({$body:$("body"),$lastSavedTimeAgo:$("#last-saved-time-ago"),$detailsTitle:$("#details-title"),$penTitle:$("#pen-title"),$templateCkbx:$("#item-details-template"),$passwordInput:$("#item-details-password-value"),$passwordArea:$(".password-protect-toggle-wrap"),init:function(){this.pageType=__pageType,this._bindToHub(),this._hidePenHasUnsavedChanges()},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this)),Hub.sub("pen-errors",$.proxy(this._onPenErrors,this)),Hub.sub("pen-saved",$.proxy(this._onPenSaved,this))},_onPenChange:function(e,t){this._showPenHasUnsavedChanges(),ObjectUtil.hasNestedValue(t,"pen.title")&&this._updatePenTitle(t),ObjectUtil.hasNestedValue(t,"pen.private")&&(this._updateBrowserURL(),this._togglePasswordArea(t)),ObjectUtil.hasNestedValue(t,"pen.password_used")&&this._togglePasswordInput(t),ObjectUtil.hasNestedValue(t,"pen.template")&&this._updateTemplate(t)},_updatePenTitle:function(e){0===e.pen.title.length&&(e.pen.title="Untitled Pen"),document.title=e.pen.title;var t=$(".pen-title-link",this.$penTitle);t.length?t.text(e.pen.title):this.$penTitle.text(e.pen.title),this.$detailsTitle.text(e.pen.title)},_updateBrowserURL:function(){if(window.history.replaceState&&CP.pen.getActiveSlugHash()){var e=URLBuilder.getViewURL(this.pageType,CP.profiled,CP.pen,!1);window.history.replaceState(e,"",e)}},_togglePasswordArea:function(e){e.pen["private"]?this.$passwordArea.removeClass("hide"):this.$passwordArea.addClass("hide")},_togglePasswordInput:function(e){e.pen.password_used?this.$passwordInput.removeClass("hide"):this.$passwordInput.addClass("hide")},_updateTemplate:function(e){this.$templateCkbx.is(":checked")!==e.pen.template&&this.$templateCkbx.attr("checked",e.pen.template)},_onPenErrors:function(e,t){$.showMessage(Copy.errors[t],"slow")},_doneWithSignupOrLogin:function(e){CP.user.updateUser(e.user),CP.pen.save()},_onPenSaved:function(e,t){this._isNewPenInProfessorOrCollab(t)?$.showMessage(_.template(Copy.penForked,t),8e3):(this._hidePenHasUnsavedChanges(),this._updateSavedTimeAgoFooter(t),this._updateTitleAndDescriptionOnDetailsPage())},_isNewPenInProfessorOrCollab:function(e){return _.contains(["professor","collab"],this.pageType)&&e.newPen},_updateSavedTimeAgoFooter:function(e){this.$lastSavedTimeAgo.html(e.last_saved_time_ago)},_updateTitleAndDescriptionOnDetailsPage:function(){"details"===this.pageType&&window.location.reload()},_showPenHasUnsavedChanges:function(){CP.pen.save_disabled||this.$body.addClass("unsaved")},_hidePenHasUnsavedChanges:function(){this.$body.removeClass("unsaved")}}),JSSettingsController=BaseSettingsController.extend({type:"js",init:function(e){this.pen=e,this.events=new JSSettingsEvents(this),this.model=new JSSettingsModel(this),this.view=new JSSettingsView(e),this.resourcesController=new ResourcesController("js")}}),JSSettingsEvents=BaseSettingsEvents.extend({type:"js",$jsPreProcessor:$("#js-preprocessor"),$jsModule:$("#js-module"),init:function(e){this._super(e),_.extend(this,EnableDisableDriver),this.bindToEnableDisableHubEvents(),this._bindToDOM(),this._bindToHub()},_bindToDOM:function(){this.$jsPreProcessor._on("change",this._selectPreProcessor,this,!0),this.$jsModule._on("change",this._selectJSModule,this,!0)},_bindToHub:function(){Hub.sub("server-pen-change",$.proxy(this._onServerPenChange,this))},_onServerPenChange:function(e,t){(ObjectUtil.hasNestedValue(t,"item.js_pre_processor")||ObjectUtil.hasNestedValue(t,"item.js_module"))&&this._setItemValueFromServer(t)},_selectPreProcessor:function(e,t){this._canDrive&&this._setItemValue({js_pre_processor:t.val()})},_selectJSModule:function(e,t){this._canDrive&&this._setItemValue({js_module:t.prop("checked")})},_getAllUIElements:function(){return[this.$jsPreProcessor]}}),JSSettingsModel=BaseSettingsModel.extend({type:"js",init:function(){this._super()}}),JSSettingsView=BaseSettingsView.extend({$boxJS:$("#box-js"),$jsPreprocessor:$("#js-preprocessor"),$jsModule:$("#js-module"),type:"js",init:function(e){this._super(),this._bindToHub(),this._updateUI(e)},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this))},_onPenChange:function(e,t){this._updateUI(t.pen)},_updateUI:function(e){ObjectUtil.hasNestedValue(e,"js_pre_processor")&&this._setPreProcessor(e.js_pre_processor),ObjectUtil.hasNestedValue(e,"js_module")&&this._setJSModule(e.js_module)},_setPreProcessor:function(e){this._addProcessorClassBoxJS(e),this._selectPreProcessor(e)},_setJSModule:function(e){this.$jsModule.prop("checked",e),this._addModuleClassBoxJS(e)},_selectPreProcessor:function(e){this.$jsPreprocessor.val(e)},_addProcessorClassBoxJS:function(e){this.$boxJS.data("preprocessor",__preprocessors.js.pretty_syntaxes[e]),this.$boxJS.removeClass(__preprocessors.js.syntaxes.join(" ")).addClass(e)},_addModuleClassBoxJS:function(e){this.$boxJS.removeClass("module"),e&&this.$boxJS.addClass("module")}});!function(){function e(e,t){return t.match("."+e+"$")}function t(e){var t=e.split("/");return t.length>0?t[t.length-1].replace(".min.","."):e.replace(".min.",".")}function n(n,i){for(var s=[],o={},r=0,c=i.length;r<c;r++)for(var u=i[r],l=u.latest.split(u.version)[0],d=u.assets[0].version,h=u.assets[0].files,p=0;p<h.length;p++){var f=h[p],_=t(f);if(e(n,_)&&!o[_]&&(o[_]=_,s.push({name:_,latest:l+d+"/"+f,keywords:u.keywords}),s.length>=a))return s}return s}function i(e,t){var i=n(e,t.results),s=$("#external-"+e+"-search").val();return TypeaheadSource.sortedMatches(s,i)}function s(e,t,n){CacheGet.find({key:e+t.url,url:t.url,dataType:"json",expire:r,onSuccess:n,createCacheableResult:function(t){return i(e,t)}})}function o(e){return new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,identify:function(t){return e+t.name},remote:{url:"https://api.cdnjs.com/libraries?fields=version,assets,keywords&search=%QUERY",cache:!1,wildcard:"%QUERY",transport:function(t,n){s(e,t,n)}}})}var r=4320,a=200;window.ResourcesBH={getInstance:o}}();var ResourcesController=Class.extend({init:function(e){this.type=e,this.events=new ResourcesEvents(this,e),this.view=new ResourcesView(e)},setItemValueFromServer:function(e){CP.pen.setPenResources(e)},addEmptyResource:function(e){CP.pen.addEmptyResource(e)},quickAddResource:function(e,t,n){CP.pen.quickAddResource(e,t),CP.PenRecentResourcesManager.addNewPenResource(e,t,n)},deleteResource:function(e){CP.pen.deleteResource(e)},setResource:function(e,t){CP.pen.setResource(e,t)},updateResourcesOrder:function(e,t){CP.pen.updateResourcesOrder(e,t)}});window.ResourcesEvents=Class.extend({init:function(e,t){this.controller=e,this.type=t,_.extend(this,EnableDisableDriver),this.bindToEnableDisableHubEvents(),this._bindToDOM(),this._bindToHub()},_bindToDOM:function(){$("#add-"+this.type+"-resource")._on("click",this._onAddResourceClick,this),$("#"+this.type+"-quick-add")._on("change",this._onQuickAddChange,this),$("#"+this.type+"-external-resources").on("click","span.remove-external-url",$.proxy(this._onDeleteResource,this)).on("keydown",this._getResourcesSelector(),$.proxy(this._onChangeResource,this)).on("change",this._getResourcesSelector(),$.proxy(this._onChangeResource,this)),$("#external-"+this.type+"-resources .recent-searches").on("click","span",$.proxy(this._onQuickAddRecentClick,this)),window.__mobile||(this._makeResourcesSortable(),this.$searchInput=$("#external-"+this.type+"-search"),this._bindToTypeahead())},_getResourcesSelector:function(){return"input."+this.type+"-resource[name='external-"+this.type+"']"},_bindToHub:function(){Hub.sub("server-pen-change",$.proxy(this._onServerPenChange,this))},_onServerPenChange:function(e,t){ObjectUtil.hasNestedValue(t,"pen.resources")&&this.controller.setItemValueFromServer(t)},_makeResourcesSortable:function(){var e=this;$("#"+this.type+"-external-resources").sortable({handle:".move-external-url",axis:"y",update:function(){e._updateResourcesOrder()}})},_updateResourcesOrder:function(){this._canDrive&&this.controller.updateResourcesOrder(this.type,this._getViewIDsToOrders())},_checkResourcesSecurity:function(e){var t=$("#external-resource-input-"+e),n=t.closest(".external-resource-url-row");"http:"===t.val().substr(0,5)?n.addClass("insecure-resource"):n.removeClass("insecure-resource")},_getViewIDsToOrders:function(){return _.reduce(this._getInputsByType(),function(e,t,n){return e[this._getElementViewID(t)]=n,e},{},this)},_getInputsByType:function(){return _.select($("#"+this.type+"-external-resources input"),function(e){return $(e).attr("id")})},_onChangeResource:function(e){if(this._canDrive){var t=this._getElementViewID(e.target);this.controller.setResource(t,$(e.target).val());var n=$(".open-external-url[data-view-id="+t+"]");n.attr("href",$(e.target).val()),this._updateResourcesOrder();var i=this;setTimeout(function(){i._checkResourcesSecurity(t)},0)}},_onAddResourceClick:function(){this._canDrive&&this.controller.addEmptyResource(this.type)},_onQuickAddChange:function(e,t){this._canDrive&&(this.controller.quickAddResource(this.type,t.val(),$("option:selected",t).text()),this._updateResourcesOrder())},_onQuickAddRecentClick:function(e){var t=e.target;this._canDrive&&(this.controller.quickAddResource(this.type,$(t).attr("data-val"),$(t).text()),this._updateResourcesOrder())},_onDeleteResource:function(e){return e.preventDefault(),this._canDrive&&(this.controller.deleteResource(this._getElementViewID(e.target)),this._updateResourcesOrder()),!1},_getElementViewID:function(e){return $(e).attr("data-view-id")},_getAllUIElements:function(){return[$("#add-"+this.type+"-resource"),$("#"+this.type+"-quick-add"),$(this._getResourcesSelector())]},_bindToTypeahead:function(){var e=this,t=$(this.$searchInput);t.typeahead(this._getTypeaheadConfiguration(),this._getTypeaheadDatasource()),t.on("typeahead:change",function(){t.val("")}),t.on("typeahead:select",function(n,i){e.controller.quickAddResource(e.type,i.latest,i.name),e._updateResourcesOrder(),setTimeout(function(){t.val("")},250)}),t.on("typeahead:asyncrequest",function(){$(".clock-spinner").addClass("show")}),t.on("typeahead:asynccancel typeahead:asyncreceive",function(){$(".clock-spinner").removeClass("show")})},_getTypeaheadConfiguration:function(){return{hint:!0,minLength:3,highlight:!0}},_getTypeaheadDatasource:function(){return{name:this.type+"-search",source:ResourcesBH.getInstance(this.type),limit:15,templates:{empty:function(){return'<div class="typeahead-no-results-found">No results found.</div>'},suggestion:function(e){return"<p>"+e.name+"<small>"+e.latest+"</small></p>"}},display:function(e){return e.latest}}}}),window.ResourcesView=Class.extend({$resources:null,$quickAdd:null,init:function(e){this.type=e,this._initDOM(),this._bindToHub()},_initDOM:function(){this.$resources=$("#"+this.type+"-external-resources"),this.$quickAdd=$("#"+this.type+"-quick-add"),this._syncExternalInputs(CP.pen.getResourcesByType(this.type)),this._appendRecentResourcesToUI(CP.PenRecentResourcesManager.getRecentPenResources(this.type))},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this))},_onPenChange:function(e,t){ObjectUtil.hasNestedValue(t,"pen.resources")&&this._syncExternalInputs(CP.pen.getResourcesByType(this.type),t.rebind)},_syncExternalInputs:function(e){this._syncNumberOfDOMElementsWithResources(e),this._syncTheDOMValuesWithResources(e),this._resetQuickAdd()},_syncNumberOfDOMElementsWithResources:function(e){var t=this._getExistingExternalsDivs(),n=e.length-t.length;if(n>0)for(;n--;){var i=e.length-1-n;this._appendResourcesToUI(e[i],i)}else if(n<0)for(n*=-1;n--;)$(t.last()).remove()},_syncTheDOMValuesWithResources:function(e){_.forEach(this._getExistingExternalsDivs(),function(t,n){t=$(t);var i=e[n];if(i.view_id===t.attr("data-view-id")){var s=$("#external-resource-input-"+i.view_id);i.url!==s.val()&&(s.removeClass("yellow-flash"),s.val(i.url),setTimeout(function(){s.addClass("yellow-flash")},10))}else t.replaceWith(this._divHTML(i))},this)},_getExistingExternalsDivs:function(){return $("#"+this.type+"-external-resources > div")},_appendResourcesToUI:function(e,t){var n=$(this._divHTML(e,t)).find(".external-resource").addClass("yellow-flash").end();this.$resources.append(n)},_appendRecentResourcesToUI:function(e){this._addRecentResourcesToClickBar(e),this._addRecentResourcesToDropdown(e)},_addRecentResourcesToClickBar:function(e){var t=$("#external-"+this.type+"-resources .recent-searches");if(e.length>0){t.append($("<strong>Recent: </strong>"));for(var n=0;n<e.length;n++)t.append($('<span class="quickadd-click" data-val="'+e[n].url+'">'+e[n].name+"</span>"))}},_addRecentResourcesToDropdown:function(e){var t=$("#"+this.type+"-quick-add"),n=$("#recent-resources",t),i=$("#popular-resources",t);if(e.length>0)for(var s=0;s<e.length;s++)$('option[value="'+e[s].url+'"]',i).remove(),n.append($('<option value="'+e[s].url+'" label="'+e[s].name+'">'+e[s].name+"</option>"))},_divHTML:function(e,t){return _.template(this._getTemplate(),{url:e.url,insecure_resource:"http:"===e.url.substr(0,5)?"insecure-resource":"",view_id:e.view_id,placeholder:this._getPlaceholderForInput(e.resource_type,t)})},_template:"",_getTemplate:function(){return""===this._template&&(this._template=$("#"+this.type+"-external-resources-template").html()),this._template},_getPlaceholderForInput:function(e,t){return t%2===0?"css"===e?"https://yourwebsite.com/style.css":"https://yourwebsite.com/script.js":"https://codepen.io/username/pen/aBcDef"},_resetQuickAdd:function(){this.$quickAdd.prop("selectedIndex",0)}});var TypeaheadSource={MAX_RESULTS:50,sortedMatches:function(e,t){return this._sort(e,this._findMatches(e.toLowerCase(),t)).splice(0,this.MAX_RESULTS)},_findMatches:function(e,t){return _.filter(t,function(t){return t.name.toLowerCase().indexOf(e)>-1||!!(t.tokens&&t.tokens.indexOf(e)>-1)})},_sort:function(e,t){return t.sort(function(t,n){var i=t.name.toLowerCase(),s=n.name.toLowerCase();if(i===e&&s!==e)return-1;if(i!==e&&s===e)return 1;var o=t.name.indexOf(e),r=n.name.indexOf(e);if(o>-1&&r===-1)return-1;if(o===-1&&r>-1)return 1;if(o>-1&&r>-1)return o<r?-1:o>r?1:i.length-e.length<s.length-e.length?-1:1;var a=t.keywords.indexOf(e),c=n.keywords.indexOf(e);return a>-1&&c===-1?-1:a===-1&&c>-1?1:0})}},SearchFilter={init:function(){this._bindToDOM()},_bindToDOM:function(){$("#assets-search")._on("keyup click search",this._onSearchChange,this,!0)},_onSearchChange:function(e,t){var n=$.trim(t.val().toLowerCase());if(""===n)$(".single-asset").removeClass("hide");else{$(".single-asset").addClass("hide");var i=".single-asset[data-searchable-name*='"+n+"']";$(i).closest(".single-asset").removeClass("hide")}}};!function(){function e(e,t){return{asset_type:"account",name:t,size:e.size,content_type:e.type}}function t(e,t,n){AJAXUtil.post("/uploaded_assets/asset_upload_request",e,function(e){var i=new FormData;for(var s in e.form_data.fields)i.append(s,e.form_data.fields[s]);i.append("file",t),$.ajax({url:e.form_data.action,data:i,processData:!1,contentType:!1,type:"POST",success:function(t,i){n(e,i)}})})}function n(n,i,s){t(e(n,i),n,function(e,t){s("success"===t?{success:!0,file:n,fileName:i}:{success:!1,file:n,error:t.text})})}function i(e,t,n){var i={asset_type:"avatar",file_ext:e.toLowerCase(),content_type:t};return n&&(i.team=!0),i}function s(e,t,n){return{asset_type:"screenshot",item_type:n,item_id:CP.pen.id,file_ext:e.toLowerCase(),content_type:t}}function o(e,n,s,o,r){t(i(s,e.type,o),n,function(e,t){var n=e.form_data.action+"/"+e.form_data.fields.key;r("success"===t?{success:!0,url:n}:{success:!1,error:t.text})})}function r(e,n,i,o,r){t(s(o,n.type,e),i,function(e,t){var n=e.form_data.action+"/"+e.form_data.fields.key;r("success"===t?{success:!0,url:n}:{success:!1,error:t.text})})}window.S3=window.S3||{},window.S3.uploadAvatarAssetToS3=o,window.S3.uploadAccountAssetFileToS3=n,window.S3.uploadScreenshotAssetToS3=r}(),jQuery.event.props.push("dataTransfer");var ScreenshotUpload={screenshotWrap:$("#settings-screenshot-wrap"),imageChanger:$("#screenshot-image-changer"),imageHolder:$("#custom-screenshot"),fileInput:$("#personal-profile-image-upload-input"),theBody:$("body"),deleteBtn:$("#delete-screenshot"),init:function(){_.extend(this,AJAXUtil),this.bindUIActions()},bindUIActions:function(){var e=this;this.uploading=this.screenshotWrap.find(".uploading-message"),this.imageChanger._on("drop",function(e){e.preventDefault(),ScreenshotUpload.handleDrop(e)}),this.theBody._on("dragover",function(e){e.currentTarget===ScreenshotUpload.theBody[0]&&ScreenshotUpload.testIfContainsFiles(e)&&ScreenshotUpload.highlightDropArea()}),this.theBody._on("dragleave",function(e){e.currentTarget===ScreenshotUpload.theBody[0]&&ScreenshotUpload.unHighlightDropArea()}),ScreenshotUpload.fileInput._on("change",function(e){ScreenshotUpload.handleManualFileSelect(e)}),this.screenshotWrap.on("click","#delete-screenshot",function(t){t.preventDefault(),$.showModal("/ajax/confirm_custom_screenshot_delete","modal-warning",function(){$("#confirm-delete-screenshot")._on("click",function(t){t.preventDefault(),e.deleteScreenshot()})})})},testIfContainsFiles:function(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1},highlightDropArea:function(){ScreenshotUpload.imageChanger.addClass("drop-here")},unHighlightDropArea:function(){ScreenshotUpload.imageChanger.removeClass("drop-here")},handleDrop:function(e){var t=e.dataTransfer.files;ScreenshotUpload.processFile(t)},handleManualFileSelect:function(e){var t=e.target.files;ScreenshotUpload.processFile(t)},processFile:function(e){this.unHighlightDropArea(),this._showUploadingMessage(!0);var t=e[0];if(t.type.match("image.*")){var n=this;this.readImage(t,function(e){"string"!=typeof e?$.showMessage("Oops! We couldn't upload that image. Try again."):(n._showSavingMessage(),n._signScreenshotAndUpload(e,t))})}else $.showMessage("Oops! That file wasn't a JPG or PNG."),ScreenshotUpload.unHighlightDropArea()},_showSavingMessage:function(){$.showMessage("Saving Screenshot...")},_showSavedMessage:function(){$.showMessage("Pen Screenshot is saved. It may take a minute to update everywhere.")},_signScreenshotAndUpload:function(e,t){var n=this.dataURItoBlob(e),i=this.fileExtension(t.name),s=this;S3.uploadScreenshotAssetToS3("pen",t,n,i,function(e){e.success?setTimeout(function(){s.saveScreenshot(e.url)},500):$.showMessage("Oops! We couldn't upload that image. Try again.")})},fileExtension:function(e){return e.split(".").pop()},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),n=new ArrayBuffer(t.length),i=new Uint8Array(n),s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return new Blob([n],{type:"image/jpeg"})},readImage:function(e,t){var n=new FileReader;n.onload=function(){t(this.result)},n.readAsDataURL(e),n.onabort=function(){$.showMessage("The upload was aborted.")},n.onerror=function(){$.showMessage("An error occurred while reading the file.")}},placeScreenshot:function(e,t){this.screenshotWrap.html(t),$("#custom-screenshot").css("background-image","url("+e+"?"+Date.now()+")"),this.deleteBtn.show(),this.uploading=this.screenshotWrap.find(".uploading-message")},removeScreenshot:function(e,t){this.screenshotWrap.html(t),this.deleteBtn.hide(),this.uploading=this.screenshotWrap.find(".uploading-message")},saveScreenshot:function(e){var t=this,n={item_type:"pen",item_id:CP.pen.slug_hash};null===CP.pen.custom_screenshot?this.post("/custom_screenshot",n,function(n){t._successfulUpdate(n,e)}):this.put("/custom_screenshot/"+CP.pen.custom_screenshot,n,function(n){t._successfulUpdate(n,e)})},_successfulUpdate:function(e,t){CP.pen.custom_screenshot=e.screenshot_hashid,this._showSavedMessage(),this.placeScreenshot(t,e.description_html),this._showUploadingMessage(!1)},deleteScreenshot:function(){this.del("/custom_screenshot/"+CP.pen.custom_screenshot,{item_type:"pen",item_id:CP.pen.slug_hash},function(e){$.hideModal(),this.removeScreenshot(e.screenshot_url_large,e.description_html),CP.pen.custom_screenshot=null})},_showUploadingMessage:function(e){e?this.uploading.css({opacity:1,visibility:"visible"}):this.uploading.css({opacity:0,visibility:"hidden"})}};!function(){ScreenshotUpload.init()}();var SettingsController=Class.extend({popupName:"penSettings",init:function(){CP.SettingsEvents.init(this),this.model=CP.SettingsModel,this.model.init(this),CP.SettingsView.init(this.model)},syncWithServer:function(e){this.model.syncWithServer(e)},toggleSettingsPane:function(){this.model.toggleSettingsPane()},hideSettingsPane:function(){this.model.hideSettingsPane()},selectSettingsTab:function(e){this.model.selectSettingsTab(e)},settingsPaneVisible:function(){return this.model.settingsPaneVisible()}}),EnableDisableDriver={_canDrive:!0,bindToEnableDisableHubEvents:function(){Hub.sub("ui-disable",$.proxy(this._disableUserFromDriving,this)),Hub.sub("ui-enable",$.proxy(this._enableUserToDrive,this))},_disableUserFromDriving:function(){this._canDrive=!1,this._disableUIElements()},_disableUIElements:function(){this._disableAllElements(this._getAllUIElements())},_disableAllElements:function(e){_.forEach(e,function(e){e&&e.attr("disabled",!0)})},_enableUserToDrive:function(){this._canDrive=!0,this._enableUIElements()},_enableUIElements:function(){this._enableAllElements(this._getAllUIElements())},_enableAllElements:function(e){_.forEach(e,function(e){e&&e.attr("disabled",!1)})}};!function(){function e(){f._on("click",t,window),g._on("click",n,window,!0),C._on("click",i,window),P._on("click",s,window),$("#item-settings-modal .tabs > nav a").unbind(),v._on("click",o,window),$("body")._on("click",r,window,!0),m._on("click",a,window)}function t(e,t){CP.SettingsEvents._canDrive&&(n(),p.selectSettingsTab(t.data("type")))}function n(){CP.SettingsEvents._canDrive&&p.toggleSettingsPane()}function i(){n(),setTimeout(function(){$("#item-details-description").focus()},600)}function s(){n(),setTimeout(function(){$("#pen-tags").focus(),$("#project-tags").focus()},600)}function o(e){if(CP.SettingsEvents._canDrive){var t=$(e.target).data("type");t&&p.selectSettingsTab(t)}}function r(e){if(b.length){var t=b[0].contains(e.target);g.length&!t&&(t=g[0].contains(e.target)),t||p.hideSettingsPane()}}function a(){CP.SettingsEvents._canDrive&&p.hideSettingsPane()}function c(){Hub.sub("key",d),Hub.sub("pen-saved",l),Hub.sub("server-ui-change",u),Hub.sub("popup-open",h)}function u(e,t){(ObjectUtil.hasNestedValue(t,"ui.settings.pane")||ObjectUtil.hasNestedValue(t,"ui.settings.tab"))&&p.syncWithServer(t)}function l(){p.hideSettingsPane()}function d(e,t){"esc"===t.key&&p.hideSettingsPane()}function h(e,t){t!==p.popupName&&p.hideSettingsPane()}var p,f=$("button.settings-nub"),g=$("#edit-settings"),v=$("#settings-tabs"),m=$("#close-settings"),w=$("#popup-overlay"),b=$("#item-settings-modal"),C=$(".edit-details-reminder"),P=$(".edit-tags-reminder");CP.SettingsEvents={},_.extend(CP.SettingsEvents,EnableDisableDriver),CP.SettingsEvents._getAllUIElements=function(){return[f,g,v,w,m]},CP.SettingsEvents.init=function(t){p=t,this.bindToEnableDisableHubEvents(),e(),c()}}(),function(){function e(){Hub.pub("ui-change",CP.SettingsModel.getState())}function t(t){CP.ui&&CP.ui.settings.pane!==t&&(CP.ui.settings.pane=t,e(),"open"===t&&Hub.pub("popup-open",n.popupName))}var n;CP.SettingsModel={init:function(e){n=e},syncWithServer:function(t){CP.ui.settings.tab=t.ui.settings.tab,CP.ui.settings.pane=t.ui.settings.pane,e()},toggleSettingsPane:function(){var e=this.settingsPaneVisible()?"closed":"open";t(e)},hideSettingsPane:function(){t("closed")},openSettingsPane:function(){t("open")},selectSettingsTab:function(t){CP.ui.settings.tab=t,e()},getState:function(){return{ui:{settings:{pane:CP.ui.settings.pane,tab:CP.ui.settings.tab}}}},settingsPaneVisible:function(){return"open"===CP.ui.settings.pane}}}(),function(){function e(){Hub.sub("ui-change",t)}function t(e,t){ObjectUtil.hasNestedValue(t,"ui.settings.pane")&&n(t.ui.settings.pane),ObjectUtil.hasNestedValue(t,"ui.settings.tab")&&r(t.ui.settings)}function n(e){"open"===e?i():s()}function i(){a||(c.addClass("open"),CP.showPopupOverlay(),o(),a=!0)}function s(){a&&(c.removeClass("open"),CP.hidePopupOverlay(),a=!1)}function o(){window.__mobile||setTimeout(function(){d.focus()},500)}function r(e){u.removeClass("active"),l.removeClass("active"),$("#settings-"+e.tab+"-tab").addClass("active"),$("#settings-"+e.tab).addClass("active")}var a=!1,c=$("#item-settings-modal"),u=$("#settings-tabs a"),l=$("div.settings"),d=$("#item-details-title");CP.SettingsView={},CP.SettingsView.init=function(n){t(null,n.getState()),e()}}();var PenTagsController=Class.extend({init:function(){this.model=new PenTagsModel,this.events=new PenTagsEvents(this),this.view=new PenTagsView(this.model)},addNewTags:function(e){this.model.addNewTags(e)},deleteTag:function(e){this.model.deleteTag(e)}}),PenTagsEvents=Class.extend({$body:$("body"),$penTags:$("#pen-tags"),init:function(e){this.controller=e,this._bindToDOM()},_bindToDOM:function(){this.$body.on("click","#active-tags span span.tag-x",$.proxy(this._handleTagDelete,this)),this.$penTags._on("keyup",this._onTagChange,this)},_onTagChange:function(){this.controller.addNewTags(this.$penTags.val())},_handleTagDelete:function(e){return e.preventDefault(),this.controller.deleteTag(this._getTagToDelete(e)),!1},_getTagToDelete:function(e){var t=$(e.target);return $.trim(t.next().html())}}),PenTagsModel=Class.extend({init:function(){},getTags:function(){return CP.pen.getTags()},addNewTags:function(e){CP.item.setItemValue({origin:"client",pen:{newTags:this._validNewTags(e)}})},_validNewTags:function(e){return _.uniq(_.map(e.split(","),function(e){return _stripHTMLTags($.trim(e).toLowerCase()).replace("&","")}))},deleteTag:function(e){CP.item.setItemValue({origin:"client",action:"delete-tag",pen:{tags:_.without(CP.pen.tags,e)}}),CP.item.setItemValue({origin:"client",action:"delete-tag",pen:{newTags:_.without(CP.pen.newTags,e)}})}}),PenTagsView=Class.extend({MAX_TAGS:5,$activeTags:$("#active-tags"),$maxTagsLabel:$("#max-tags-label"),$penTags:$("#pen-tags"),init:function(e){this.model=e,this._initiateView(),this._bindToHub()},_initiateView:function(){this._updateActiveTagsHTML(this.model.getTags())},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this)),Hub.sub("pen-saved",$.proxy(this._onPenSaved,this))},_onPenSaved:function(){this.$penTags.val("")},_onPenChange:function(e,t){"pen"in t&&("tags"in t.pen&&this._updateActiveTagsHTML(this.model.getTags()),"newTags"in t.pen&&(this._updatePenTagsVal(t),this._updateActiveTagsHTML(this.model.getTags())))},_updateActiveTagsHTML:function(e){this.$activeTags.html(this._getTagsHTML(e)),this._warnAboutTooManyTags(e)},_getTagsHTML:function(e){for(var t="",n=0;n<e.length;n++)e[n]&&(t+="<span class='tag'>",t+="<span class='tag-x' style='cursor:pointer;'>",t+="<span class='tag-x'>\xd7</span>&nbsp;",t+="<span class='tag-name'>"+e[n]+"</span> ",t+="</span> ",t+="</span>");return t},_updatePenTagsVal:function(e){"delete-tag"===e.action&&this.$penTags.val(e.pen.newTags.join(","))},_warnAboutTooManyTags:function(e){e.length>=this.MAX_TAGS?this.$maxTagsLabel.addClass("at-capacity"):this.$maxTagsLabel.removeClass("at-capacity")}}),ProjectTagsController=Class.extend({init:function(){this.model=new ProjectTagsModel,this.events=new ProjectTagsEvents(this),this.view=new ProjectTagsView(this.model)},addNewTags:function(e){this.model.addNewTags(e),this.view.updateTags()},deleteTag:function(e){this.model.deleteTag(e)}}),ProjectTagsEvents=Class.extend({$body:$("body"),$projectTags:$("#project-tags"),init:function(e){this.controller=e,this._bindToDOM()},_bindToDOM:function(){this.$body.on("click","#active-tags span span.tag-x",$.proxy(this._handleTagDelete,this)),this.$projectTags._on("keyup",this._onTagChange,this)},_onTagChange:function(){this.controller.addNewTags(this.$projectTags.val())},_handleTagDelete:function(e){return e.preventDefault(),this.controller.deleteTag(this._getTagToDelete(e)),!1},_getTagToDelete:function(e){var t=$(e.target);return $.trim(t.next().html())}}),ProjectTagsModel=Class.extend({init:function(){},getTags:function(){return CP.item.getTags()},addNewTags:function(e){CP.item.setItemValue({origin:"client",item:{newTags:this._validNewTags(e)}})},_validNewTags:function(e){return _.uniq(_.map(e.split(","),function(e){return _stripHTMLTags($.trim(e).toLowerCase()).replace("&","")}))},deleteTag:function(e){CP.item.setItemValue({origin:"client",action:"delete-tag",item:{tags:_.without(CP.item.tags,e)}}),CP.item.setItemValue({origin:"client",action:"delete-tag",item:{newTags:_.without(CP.item.newTags,e)}})}}),ProjectTagsView=Class.extend({MAX_TAGS:5,$activeTags:$("#active-tags"),$maxTagsLabel:$("#max-tags-label"),$projectTags:$("#project-tags"),init:function(e){this.model=e,this._initiateView()},_initiateView:function(){this._updateActiveTagsHTML(this.model.getTags())},_onProjectSaved:function(){this.$projectTags.val("")},updateTags:function(){this._updateActiveTagsHTML(this.model.getTags()),this._updateProjectTagsVal(CP.item.newTags),this._updateActiveTagsHTML(this.model.getTags())},_updateActiveTagsHTML:function(e){this.$activeTags.html(this._getTagsHTML(e)),this._warnAboutTooManyTags(e)},_getTagsHTML:function(e){for(var t="",n=0;n<e.length;n++)e[n]&&(t+='<span class="tag">',t+='<span class="tag-x" style="cursor:pointer;">',t+='<span class="tag-x">\xd7</span>&nbsp;',t+='<span class="tag-name">'+e[n]+"</span> ",t+="</span> ",t+="</span>");return t},_updateProjectTagsVal:function(e){"delete-tag"===e.action&&this.$projectTags.val(e.project.newTags.join(","))},_warnAboutTooManyTags:function(e){e.length>=this.MAX_TAGS?this.$maxTagsLabel.addClass("at-capacity"):this.$maxTagsLabel.removeClass("at-capacity");
}}),PenActions=Class.extend({init:function(){this._bindToDOM()},_bindToDOM:function(){$("#save, #update, #save-details")._on("click",this._savePen,this),$("#pen-details-form")._on("submit",this._savePen,this),$("#save-as-private")._on("click",this._savePenAsPrivate,this),$("#fork")._on("click",this._fork,this),$("#run")._on("click",this._runPen,this),$("#live-view-popout-button")._on("click",this._liveViewPopout,this)},_savePen:function(){CP.pen.save()},_savePenAsPrivate:function(){CP.pen.saveAsPrivate()},_fork:function(){CP.pen.forkPenInCurrentState()},_runPen:function(){CP.penRenderer.processAndRender(!0)},_liveViewPopout:function(){CP.pen.liveViewPopout()}});!function(){function e(){"vim"===CP.pen.editor_settings.key_bindings&&(CodeMirror.commands.save=function(){CP.pen.save()})}function t(){l.on("click",n),d.on("click",s)}function n(e){e.preventDefault(),h?s():i()}function i(){!h&&u.length&&(u.show(),CP.showPopupOverlay(),h=!0,Hub.pub("popup-open",p))}function s(){h&&u.length&&(u.hide(),CP.hidePopupOverlay(),h=!1)}function o(){Hub.sub("key",r),Hub.sub("popup-open",a)}function r(e,t){"esc"===t.key&&s()}function a(e,t){t!==p&&s()}function c(){Keytrap.bind("comctrl+e",function(){$("#new-comment").focus()},!0),Keytrap.bind("comctrl+s",function(){("collab"!==window.__pageType&&"professor"!=window.__pageType||CP.pen.isUserPenOwner())&&CP.pen.save()},!0),Keytrap.bind("comctrl+shift+s",function(){CP.pen.saveAsPrivate()},!0),Keytrap.bind("comctrl+p",function(){CP.pen.newPen()},!0),Keytrap.bind("comctrl+shift+5",function(){CP.penRenderer.processAndRender(!0)},!0),Keytrap.bind("comctrl+shift+0",function(){if(CP.pen.slug_hash){var e=document.location.href.replace("/pen/","/full/");window.open(e)}},!0),Keytrap.bind("comctrl+shift+9",$.proxy(function(){n()},this),!0),Keytrap.bind("comctrl+i",function(){CP.settingsController.toggleSettingsPane()},!0),Keytrap.bind("comctrl+shift+.",function(){CP.htmlEditor.hasFocus()&&CP.htmlEditor.editor.execCommand("closeTag")},!0)}CP.keyBindings={},CP.keyBindings.init=function(){e(),t(),o(),c()};var u=$("#keycommands"),l=$(".keyboard-commands-button"),d=$("#popup-overlay"),h=!1,p="keyCommands"}();var ShareGist=Class.extend({WAITING_MSG_TIMEOUT:1e4,GIST_MSG_TIMEOUT:7e3,init:function(e){_.extend(this,AJAXUtil),this._shareView=e,this._bindToDOM()},_bindToDOM:function(){$("#share-gist")._on("click",$.proxy(this._createGist,this))},_createGist:function(){$.showMessage(Copy.waitingForGist,this.WAITING_MSG_TIMEOUT),this.post("/share/gist.json",{data:JSON.stringify(CP.pen)},this._doneCreateGist)},_doneCreateGist:function(e){if(e.reauth&&$.showModal("/ajax/reauthenticate_github","modal-error",function(){$("#cancel-reauth")._on("click",function(){$.hideModal()})}),e.url){var t=_.template(Copy.gistCreated,{url:e.url});$.showMessage(t,this.GIST_MSG_TIMEOUT),window.open(e.url)}}}),ShareSMS=Class.extend({$sendToPhone:$("#send-to-phone"),$sendToPhoneForm:$("#send-to-phone-form"),$sendButton:$("#sms-send-button"),$smsPhone:$("#sms-phone"),$textsLeft:$("#texts-left"),init:function(e){_.extend(this,AJAXUtil),this._shareView=e,this._bindToDOM(),this._loadSMSPhoneNumberFromCookie()},_bindToDOM:function(){this.$sendToPhoneForm._on("submit",this.sendSMS,this)},_loadSMSPhoneNumberFromCookie:function(){$.cookie("sms_phone_number")&&this.$sendToPhone.val($.cookie("sms_phone_number"))},sendSMS:function(){this.$sendButton.prop("disabled",!0);var e={phone_number:this.$sendToPhone.val(),item_type:"pen",item_id:CP.pen.getActiveSlugHash()};this.post("/share/sms/",e,this._doneSendSMS,this._failedSendSMS)},_doneSendSMS:function(e){this._clearSMSErrors(),this._setSMSPhoneNumberCookie(e),this.$sendButton.prop("disabled",!1),this.$textsLeft.html(e.sms_left),$.showMessage(_.template(Copy.smsSentTo,{phone_number:e.phone_number}),"slow")},_setSMSPhoneNumberCookie:function(e){var t={expires:30,domain:document.location.host,path:"/"};$.cookie("sms_phone_number",e.phone_number,t)},_failedSendSMS:function(e){this._clearSMSErrors(),this.$sendButton.prop("disabled",!1),this.$smsPhone.addClass("error"),this.$smsPhone.append(this._getErrorsHTML(e))},_getErrorsHTML:function(e){var t="";for(var n in e.errors)t+="<div class='error-message'>"+e.errors[n]+"</div>";return t},_clearSMSErrors:function(){this.$smsPhone.removeClass("error"),$(".error-message").remove()}}),ShareView=Class.extend({$downloadExportIFrame:null,init:function(){_.extend(this,AJAXUtil),this.shareSMS=new ShareSMS(this),this.shareGist=new ShareGist(this),this._bindToDOM(),this._bindToHub(),this._updateRoomLinks()},_bindToHub:function(){Hub.sub("pen-change",$.proxy(this._onPenChange,this))},_bindToDOM:function(){$("#share-zip").on("click",$.proxy(this._onShareZipClick,this))},_onPenChange:function(e,t){ObjectUtil.hasNestedValue(t,"pen.private")&&this._updateRoomLinks()},_updateRoomLinks:function(){$("#editor-link").attr("href",this._getViewURL("pen")),$("#details-link").attr("href",this._getViewURL("details")),$("#full-page-link").attr("href",this._getViewURL("full")),$("#full-page-url").val(URLBuilder.getShortViewURL("",CP.pen)),$("#live-view-link").attr("href",this._getViewURL("live")),$("#live-view-url").val(URLBuilder.getShortViewURL("v",CP.pen));var e=this._getViewURL("collab");$("#collab-view-link").attr("href",e),$("#collab-link").attr("href",e),$("#collab-view-url").val(URLBuilder.getShortViewURL("c",CP.pen));var t=this._getViewURL("professor");$("#professor-view-link").attr("href",t),$("#professor-link").attr("href",t),$("#professor-view-url").val(URLBuilder.getShortViewURL("p",CP.pen)),$("#share-zip").attr("href",this._getViewURL("share/zip"))},_onShareZipClick:function(e){e.stopPropagation();var t=$(e.target).attr("href");return this.$downloadExportIFrame?this.$downloadExportIFrame.attr("src",t):this.$downloadExportIFrame=$("<iframe>",{id:"downloadExportIFrame",src:t}).hide().appendTo("body"),!1},_getViewURL:function(e){return URLBuilder.getViewURL(e,CP.profiled,CP.pen,!1)}});BarDragger.prototype=Object.create(Unidragger.prototype),BarDragger.prototype.staticClick=function(e,t){this.emitEvent("staticClick",[e,t]),this.didFirstClick?(this.emitEvent("doubleClick",[e,t]),delete this.didFirstClick,clearTimeout(this.doubleClickTimeout)):(this.didFirstClick=!0,this.doubleClickTimeout=setTimeout(function(){delete this.didFirstClick}.bind(this),BarDragger.DOUBLE_CLICK_TIME))},BarDragger.DOUBLE_CLICK_TIME=350;var Copy={autoSavingNow:"Autosave enabled. <a href='https://blog.codepen.io/documentation/editor/autosave/' target='_blank'>?</a>",penUpdated:"Pen saved.",penForked:"We forked this Pen. It's saved to your account, but you can <a href='<%= url %>' target='_blank'>view it here.</a>",waitingForGist:"Creating GitHub Gist. Please be patient and stay awesome.",gistCreated:"Thanks for staying awesome. <a href='<%= url %>' target='_blank'> Here's a link to your Gist.</a>",youHaveUnsavedChanges:"You have NOT saved your Pen. Stop and save if you want to keep your Pen.",youHaveUnsavedSettings:"You have unsaved settings changes, are you sure you want to leave without saving?",collectionSavedPenAdded:"Your Collection '<%= name %>' was created and this Pen was added to it. <a href='<%= url %>'>View Collection</a>.",penAddToCollection:"This Pen was added to the '<%= name %>' Collection. <a href='<%= url %>'>View Collection</a>.",smsSentTo:"Text sent to phone <%= phone_number %>.",pauseAndPlay:"Pause and Play",catchUpToClass:"Catch Up to Class",studentWatching:"Student Watching",studentsWatching:"Students Watching",unsubcribedFromCommentNotifications:"You've been unsubscribed from comments for this Pen",subscribedToCommentNotifications:"You've been subscribed to comments for this Pen",deletingPen:"Deleting this Pen. Buckle up!",viewSource:"View Source",returnToSource:"Return to Source",errors:{"anon-cannot-save-during-rt-session":"Please login to save this Pen.","unable-to-save-try-again":"Unable to save Pen. Trying again for the <%= time %> time. Please be patient.","unable-to-save-ever":"Unable to save pen. Please contact support@codepen.io.","disabled-cookies":"You will not be able to see live changes to a Pen while cookies are disabled","pen-too-large":"This Pen is larger than the 1 megabyte limit. Try removing data from this Pen and trying again."}},CPFactory={buildDataObjects:function(){CP.profiled=new Profiled,CP.user=new User,"pen"===window.__itemType?(CP.pen=new Pen,CP.penSaver=new PenSaver,CP.penAutosave=new PenAutosave,CP.ui=UI.buildDefaultUIData(),CP.item=CP.pen):"project"===window.__itemType&&(CP.item=new Project,CP.ui=UI.buildDefaultUIData()),CP.itemType=window.__itemType},buildEditorObjects:function(e){CP.penErrorHandler=new PenErrorHandler,CP.penResources=new PenResources,CP.penProcessor=new PenProcessor,CP.penRenderer=new PenRenderer,CP.codeEditorAnalayze=new CodeEditorAnalyze,CP.htmlEditor=new HTMLEditor("html",CP.pen.html),CP.cssEditor=new CSSEditor("css",CP.pen.css),CP.jsEditor=new JSEditor("js",CP.pen.js),e||CP.ConsoleEditor.init(),this.buildCommonEditorSettingsObjects(),this._buildSettingsObjects()},buildCommonEditorSettingsObjects:function(){CP.pen?(CP.shareView=new ShareView,CP.settingsController=new SettingsController,CP.penActions=new PenActions,CP.infoController=new InfoController,CP.headerController.init(),CP.tagsController=new PenTagsController):CP.item&&"project"==CP.itemType&&(CP.settingsController=new SettingsController,CP.projectActions=new ProjectActions,CP.infoController=new InfoController,CP.tagsController=new ProjectTagsController)},_buildSettingsObjects:function(){CP.htmlSettingsController=new HTMLSettingsController(CP.pen),CP.cssSettingsController=new CSSSettingsController(CP.pen),CP.jsSettingsController=new JSSettingsController(CP.pen),CP.behaviorController=new BehaviorController(CP.pen)},buildDesktopViewEditorObjects:function(){CP.codeEditorResizeController.init(),CP.editorDropDowns.init(),CP.codeEditorTidyController=new CodeEditorsTidyController,CP.codeEditorsCSSTransitionHandler=new CodeEditorsCSSTransitionHandler,CP.codeEditorsViewSourceController=new CodeEditorsViewSourceController,CP.keyBindings.init()}};!function(){function e(){var e=document.location.href.replace(/&?bookmarklet_id=[^=]+/,"").replace(/\?$/,"");window.history.replaceState(e,"",e)}window.CP.cleanEditorURL=e}();var HandleIFrameClicks={init:function(e){this.pen=e,this._bindToDOM()},_bindToDOM:function(){_onMessage($.proxy(this.handleIFrameClickEvent,this))},handleIFrameClickEvent:function(e){if(this._allowedToOpenWindows()){var t=this._cleanURL(this._getURLFromEvent(e));t.match(/^https?:\/\/\S+$/)&&window.open(t)}},_allowedToOpenWindows:function(){return this.pen.user_id>1},_getURLFromEvent:function(e){return"string"==typeof e.data?e.data:""},_cleanURL:function(e){var t=this._getIFrameURLRemoved(e);return t=this._sanitizeURL(t),t=t.replace(/(java|vb)?script/gim,""),t=t.replace(/eval/gim,""),t=t.split("?")[0]},_getIFrameURLRemoved:function(e){return e.replace(/http(s)?:\/\/(s\.)?codepen\.(dev|io)\/(boomerang\/\S+|\S+\/fullpage)\/\w+(\.html)?/m,"")},_sanitizeURL:function(e){return e.replace(/[^-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]/,"")}},TimeUtil={countToString:function(e){var t={1:"first",2:"second",3:"third",4:"fourth",5:"fifth"};return e in t?t[e]:e}},TypesUtil={_HTML_TYPES:["html","xml","haml","markdown","slim","pug","application/x-slim"],_CSS_TYPES:["css","less","scss","sass","stylus","text/css","text/x-sass","text/x-scss","text/x-less","text/x-styl"],_JS_TYPES:["js","javascript","coffeescript","livescript","typescript","text/javascript","text/x-coffeescript","text/x-livescript","text/typescript"],cmModeToType:function(e){var t=this._getSafeInputMode(e);return this._getType(t)},_getSafeInputMode:function(e){var t="string"==typeof e?e:e.name;return t.toLowerCase()},syntaxToType:function(e){return this._getType(e)},_getType:function(e){return this._isHTMLType(e)?"html":this._isCSSType(e)?"css":this._isJSType(e)?"js":"unknown"},_isHTMLType:function(e){return _.contains(this._HTML_TYPES,e)},_isCSSType:function(e){return _.contains(this._CSS_TYPES,e)},_isJSType:function(e){return _.contains(this._JS_TYPES,e)}};if(NastyBrowserSniffing.ie()<11){var editorPage=window.location.href.indexOf("/pen")>-1||window.location.href.indexOf("/project/editor")>-1||window.location.href.indexOf("/project/live"),redirect="/unsupported/";if(editorPage){var initData=document.getElementById("init-data").getAttribute("value");"string"==typeof initData&&(initData=JSON.parse(initData),initData.__debug_redirect&&(redirect="/unsupported?redirect="+encodeURI(initData.__debug_redirect)))}window.location=redirect}var Comment={userLinkTimer:0,preventUserClick:!1,TIME_TO_SCROLL_TO_COMMENT:600,init:function(){_.extend(this,AJAXUtil),this._bindToElements(),"pen"==__pageType?$.when($.getScript(__syntax_highlighting_script),$.getScript(__run_mode_script)).then(function(){SyntaxHighlightComments.init()}):(this._jumpToCommentOnLoad(),$.when($.getScript(__syntax_highlighting_script),$.getScript(__standalone_run_mode_script)).then(function(){SyntaxHighlightComments.init()}))},_jumpToCommentOnLoad:function(){""!==document.location.hash&&$("html, body").animate({scrollTop:$(document.location.hash).offset().top},this.TIME_TO_SCROLL_TO_COMMENT)},_bindToElements:function(){$("#comment-form")._on("submit",this.submitNewComment,this),$("#comment-list").on("click",".comment-delete",function(e){e.preventDefault();var t=this;$.showModal("/ajax/confirm_comment_delete","modal-warning",function(){$("#confirm-delete")._on("click",function(){$.hideMessage(),window.Comment._onClickCommentDelete($(t).data("id"))})})}).on("click",".comment-edit",function(e){window.Comment.editComment($(this).data("id")),e.preventDefault()}).on("submit",".comment-editing-area",function(e){e.preventDefault(),window.Comment.updateComment($(this).data("id"))}).on("click",".edit-cancel-button",function(e){e.preventDefault(),window.Comment.cancelEdit($(this).data("id"))}),$("#subscribe-link")._on("click",this._onToggleSubscribe,this),this.bindToUsernameClickActionsInComments()},_onClickCommentDelete:function(e){window.Comment.deleteComment(e)},bindToUsernameClickActionsInComments:function(){var e=$(".username");e.off(),e.on("click",this.appendUsernameToTextarea)},appendUsernameToTextarea:function(){clearTimeout(Comment.userLinkTimer),Comment.preventUserClick=!0,Comment.chatTextArea=$("#new-comment");var e=Comment.chatTextArea.val()+$(this).text()+" ";Comment.chatTextArea.focus().val(e),window.location="#leave-comment"},submitNewComment:function(){if(this.isValidComment()){var e=this.getCommentData();this.indicateCommentSent(),this.post(this.getNewCommentURL(),e,this.doneSubmitNewComment)}},isValidComment:function(){return $.trim($("#new-comment").val())},getCommentData:function(){return{item_type:CP.itemType,kind:"comment",text:$.trim($("#new-comment").val())}},indicateCommentSent:function(){$("#new-comment").val("").focus(),$("#submit").addClass("in-action")},getNewCommentURL:function(){return["/comment",CP.user.username,CP.itemType,CP.item.getActiveSlugHash()].join("/")},doneSubmitNewComment:function(e){$("#no-comments").remove(),$("#comment-list").append(e.html),$("#submit").removeClass("in-action"),Hub.pub("comment-added"),ga("send","event",{eventCategory:"Comments",eventAction:"Comment Added",eventLabel:"Page Type: "+__pageType}),this.bindToUsernameClickActionsInComments()},deleteComment:function(e){this.post("/comment/delete/"+CP.itemType+"/"+e,{},this.doneDeleteComment)},doneDeleteComment:function(e){var t=$("#comment-id-"+e.id);t.slideUp(400,function(){t.remove()}),Hub.pub("comment-deleted")},editComment:function(e){var t=$("#comment-id-"+e);t.hasClass("being-edited")||(t.addClass("being-edited"),this.getCommentToEdit(e))},getCommentToEdit:function(e){this.get("/comment/edit/"+CP.itemType+"/"+e,{},this.doneGetCommentToEdit)},doneGetCommentToEdit:function(e){this.setUpCommentEditing(e.id,e.markdown)},setUpCommentEditing:function(e,t){var n=$("#comment-id-"+e),i=n.find(".comment-text"),s=i.height();s<80&&(s=80),i.hide(),n.append(t),MarkdownButtons.addMarkDownButtons(n.find(".comment-editing-textarea")),$("#comment-editing-textarea-"+e).height(s)},updateComment:function(e){var t=$("#comment-editing-form-"+e);t.find(".action-button").addClass("in-action");var n=t.find(".comment-editing-textarea").val();this.post("/comment/edit/"+CP.itemType+"/"+e,{text:n},this.doneUpdateComment)},doneUpdateComment:function(e){var t=$("#comment-editing-form-"+e.id);t.remove();var n='<div class="comment-text">'+e.text+"</div>";$("li#comment-id-"+e.id).removeClass("syntax-highlighting-done").find(".comment-text").remove().end().find(".block-comment-content").append(n),t.find(".action-button").removeClass("in-action"),$("#comment-id-"+e.id).removeClass("being-edited"),Hub.pub("comment-added",e)},cancelEdit:function(e){var t=$("#comment-editing-form-"+e);t.remove();var n=$("#comment-id-"+e),i=n.find(".comment-text");i.show(),$("#comment-id-"+e).removeClass("being-edited")},_onToggleSubscribe:function(e,t){t.data("unsubscribe-msg")===$.trim(t.html())?(t.html(t.data("subscribe-msg")),this._unsubscribeUserFromCommentNotifications()):(t.html(t.data("unsubscribe-msg")),this._subscribeUserToCommentNotifications())},_subscribeUserToCommentNotifications:function(){var e="/comment/subscribe/"+CP.itemType+"/"+CP.item.getActiveSlugHash();this.post(e,{sub_action:"subscribe"})},_unsubscribeUserFromCommentNotifications:function(){var e="/comment/subscribe/"+CP.itemType+"/"+CP.item.getActiveSlugHash();this.post(e,{sub_action:"unsubscribe"})}},Follow={init:function(){_.extend(this,AJAXUtil),this.profiled=__profiled,this._bindToDOM()},_bindToDOM:function(){this._addOnHoverChangeToFollowButton(),$("#follow-this-user, #following-this-user")._on("click",this.followThisUser,this)},_addOnHoverChangeToFollowButton:function(){$("#following-this-user").hover(function(){$(this).addClass("red").data("text-value",$(this).html()).html("<svg class='icon-x'><use xlink:href='#x'></use></svg> Following")},function(){$(this).removeClass("red").html($(this).data("text-value"))})},followThisUser:function(){var e=this._getActionTypeTaken();this._updateFollowButtonImmediately(e),this.post(this._getFollowUnfollowURL(e),{},this._doneFollowThisUser)},_getActionTypeTaken:function(){return $("#follow-this-user").is(":visible")?"follow":"unfollow"},_getFollowUnfollowURL:function(e){var t="/follow/<%= type %>/<%= username %>/<%= action %>";return _.template(t,{type:this.profiled.type,username:this.profiled.username,action:e})},_updateFollowButtonImmediately:function(e){"follow"===e?($("#follow-this-user").hide(),$("#following-this-user").show()):($("#follow-this-user").show(),$("#following-this-user").hide())},_doneFollowThisUser:function(e){$("#followers-tab").hasClass("active")&&$("#followers").replaceWith(e.html)}},DetailsSocial={init:function(){setTimeout(function(){$("#social-buttons").animate({opacity:1})},2e3)}};DetailsSocial.init();var Layout={$resultDiv:$("#result_div"),$resizer:$("#resizer"),$dragCover:$("#drag-cover"),dragStartResultDivHeight:null,init:function(){this.initLayout()},initLayout:function(){var e=new BarDragger(this.$resizer[0]);e.on("pointerDown",$.proxy(this.onResizerPointerDown,this)),e.on("pointerUp",$.proxy(this.onResizerPointerUp,this)),e.on("dragStart",$.proxy(this.onResizerDragStart,this)),e.on("dragMove",$.proxy(this.onResizerDragMove,this))},onResizerPointerDown:function(){this.$dragCover.show()},onResizerPointerUp:function(){this.$dragCover.hide()},onResizerDragStart:function(){this.dragStartResultDivHeight=this.$resultDiv.height()},onResizerDragMove:function(e,t,n){var i=this.dragStartResultDivHeight+n.y;i=Math.max(0,i),this.$resultDiv.height(i)},doneLoading:function(){var e=$("body");$(window).load(function(){e.removeClass("preload")})}};Layout.init();var DetailsPaging={activeTab:"",loversPaginatedIn:!1,loversPage:1,init:function(){_.extend(this,AJAXUtil)},ajaxInTab:function(e){var t=URLBuilder.getViewURL("detailstab",CP.profiled,CP.pen,!1),n={type:e};this.get(t,n,this.doneAjaxInTab),this.activeTab=e},doneAjaxInTab:function(e){"similar"===e.type&&$("div.tabs #similar").html(e.html)}},Details={win:$(window),iframe:$("#result"),init:function(){_.extend(this,AJAXUtil),this.bindToElements(),this.initPagesOnLoad(),this.markdownButtons(),this.customHeight(),Page.renderPages(window.__lovers_pages)},bindToElements:function(){$("#explore-tab-lovers, #explore-tab-forks, #explore-tab-similar")._on("click",this.initPage,this,!0),PenScreenShotPreview.bindToPreview(),this.win.on("resize",this.resizeIframe).trigger("resize")},markdownButtons:function(){MarkdownButtons.addMarkDownButtons($("#new-comment"))},initPagesOnLoad:function(){var e=document.location.hash.replace("#","");this.getPageBasedOnActiveTab(e)},initPage:function(e,t){var n=t.attr("href").replace("#","");this.getPageBasedOnActiveTab(n)},getPageBasedOnActiveTab:function(e){switch(e){case"forks":Page.renderPages(window.__forks_pages);break;case"lovers":Page.renderPages(window.__lovers_pages);break;case"similar":DetailsPaging.ajaxInTab(e)}},resizeIframe:function(){Details.iframe.width(Details.win.width())},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},customHeight:function(){var e=this.getParameterByName("preview_height");e>0&&($("#result_div").height(e),$("#resizer").css("top",parseInt(e,10)+61))}};CPFactory.buildDataObjects(),CPFactory.buildCommonEditorSettingsObjects(),Follow.init(),Comment.init(),DetailsPaging.init(),Details.init();